<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>NanoDet训练 | polar-bear～Blog</title><meta name="author" content="Ziyourufeng"><meta name="copyright" content="Ziyourufeng"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="NANODET训练 github：RangiLyu&#x2F;nanodet: NanoDet-Plus⚡Super fast and lightweight anchor-free object detection model. 🔥Only 980 KB(int8) &#x2F; 1.8MB (fp16) and run 97FPS on cellphone🔥 [https:&#x2F;&#x2F;github.com&#x2F;Rangi">
<meta property="og:type" content="article">
<meta property="og:title" content="NanoDet训练">
<meta property="og:url" content="https://polar-bear.eu.org/2025/04/21/nanodet-xun-lian-ce-shi/index.html">
<meta property="og:site_name" content="polar-bear～Blog">
<meta property="og:description" content="NANODET训练 github：RangiLyu&#x2F;nanodet: NanoDet-Plus⚡Super fast and lightweight anchor-free object detection model. 🔥Only 980 KB(int8) &#x2F; 1.8MB (fp16) and run 97FPS on cellphone🔥 [https:&#x2F;&#x2F;github.com&#x2F;Rangi">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://polar-bear.eu.org/img/test/30.png">
<meta property="article:published_time" content="2025-04-21T02:34:54.364Z">
<meta property="article:modified_time" content="2025-07-22T23:41:33.859Z">
<meta property="article:author" content="Ziyourufeng">
<meta property="article:tag" content="技术宅拯救世界~~!">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://polar-bear.eu.org/img/test/30.png"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://polar-bear.eu.org/2025/04/21/nanodet-xun-lian-ce-shi/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.polar-bear.eu.org/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"找不到您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'NanoDet训练',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2025-07-23 07:41:33'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><script async data-pjax src="/js/anzhiyu.js"></script><link rel="stylesheet" href="/css/music.css"><script charset="UTF-8" id="LA_COLLECT" src="//sdk.51.la/js-sdk-pro.min.js"></script> <script>LA.init({id:"3IMmTwvFHv6eiiJT",ck:"3IMmTwvFHv6eiiJT",autoTrack:true,hashMode:true})</script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9820372911946431" crossorigin="anonymous"></script><!-- hexo injector head_end start --><link rel="stylesheet" href="/css/font-awesome-animation.min.css" media="defer" onload="this.media='all'"><link rel="stylesheet" href="/css/tag_plugins.css" media="defer" onload="this.media='all'"><script src="/js/carousel-touch.js"></script><link rel="stylesheet" href="/css/animate.min.css" media="print" onload="this.media='screen'"><link rel="stylesheet" href="/css/gitcalendar.css" media="print" onload="this.media='all'"><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="polar-bear～Blog" type="application/atom+xml">
<link rel="stylesheet" href="/css/prism-coy.css" type="text/css"></head><body><div id="web_bg"></div><div id="an_music_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/hand.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">86</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">19</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">10</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 回家</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="fa-fw fas fa-archive"></i><span> 文章</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 文章</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li><li><a class="site-page child" href="/atom.xml"><i class="fa-fw fas fa-rss"></i><span> RSS</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="fa-fw fas fa-gift"></i><span> 娱乐</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/maomao/"><i class="fa-fw fas fa-paw"></i><span> 来只猫猫</span></a></li><li><a class="site-page child" href="/News/"><i class="fa-fw fas fa-book"></i><span> 每日新闻</span></a></li><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/random.html"><i class="fa-fw fas fa-rocket"></i><span> 随机传送(可能出错)</span></a></li><li><a class="site-page child" href="/mao/"><i class="fa-fw fas fa-gamepad"></i><span> 抓住逃跑的猫咪</span></a></li><li><a class="site-page child" href="/interesting/"><i class="fa-fw fas fa-gift"></i><span> 其他</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="fa-fw fas fa-users"></i><span> 社交</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></li><li><a class="site-page child" href="/fcircle/"><i class="fa-fw fas fa-link"></i><span> 友链朋友圈</span></a></li><li><a class="site-page child" href="/sponsor/"><i class="fa-fw fas fa-star"></i><span> 赞助墙</span></a></li><li><a class="site-page child" href="/message/"><i class="fa-fw fas fa-envelope"></i><span> 留言版</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="fa-fw fas fa-cog"></i><span> 工具</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://status.polar-bear.eu.org/"><i class="fa-fw fas fa-cog"></i><span> 站点监控</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://chat.polar-bear.eu.org/"><i class="fa-fw fas fa-link"></i><span> 镜像chatGPT</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://chouxiang.polar-bear.eu.org/"><i class="fa-fw fas fa-asterisk"></i><span> 抽象话生成器</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://lipstick.polar-bear.eu.org/"><i class="fa-fw fas fa-asterisk"></i><span> 口红颜色可视化</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/img/test/30.png')"><nav id="nav"><span id="blog-info"><a href="/" title="polar-bear～Blog"><span class="site-name">polar-bear～Blog</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 回家</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="fa-fw fas fa-archive"></i><span> 文章</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 文章</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li><li><a class="site-page child" href="/atom.xml"><i class="fa-fw fas fa-rss"></i><span> RSS</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="fa-fw fas fa-gift"></i><span> 娱乐</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/maomao/"><i class="fa-fw fas fa-paw"></i><span> 来只猫猫</span></a></li><li><a class="site-page child" href="/News/"><i class="fa-fw fas fa-book"></i><span> 每日新闻</span></a></li><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/random.html"><i class="fa-fw fas fa-rocket"></i><span> 随机传送(可能出错)</span></a></li><li><a class="site-page child" href="/mao/"><i class="fa-fw fas fa-gamepad"></i><span> 抓住逃跑的猫咪</span></a></li><li><a class="site-page child" href="/interesting/"><i class="fa-fw fas fa-gift"></i><span> 其他</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="fa-fw fas fa-users"></i><span> 社交</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></li><li><a class="site-page child" href="/fcircle/"><i class="fa-fw fas fa-link"></i><span> 友链朋友圈</span></a></li><li><a class="site-page child" href="/sponsor/"><i class="fa-fw fas fa-star"></i><span> 赞助墙</span></a></li><li><a class="site-page child" href="/message/"><i class="fa-fw fas fa-envelope"></i><span> 留言版</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="fa-fw fas fa-cog"></i><span> 工具</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://status.polar-bear.eu.org/"><i class="fa-fw fas fa-cog"></i><span> 站点监控</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://chat.polar-bear.eu.org/"><i class="fa-fw fas fa-link"></i><span> 镜像chatGPT</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://chouxiang.polar-bear.eu.org/"><i class="fa-fw fas fa-asterisk"></i><span> 抽象话生成器</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://lipstick.polar-bear.eu.org/"><i class="fa-fw fas fa-asterisk"></i><span> 口红颜色可视化</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">NanoDet训练</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-04-21T02:34:54.364Z" title="发表于 2025-04-21 10:34:54">2025-04-21</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-07-22T23:41:33.859Z" title="更新于 2025-07-23 07:41:33">2025-07-23</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="NanoDet训练"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h2 id="NanoDet训练">NanoDet训练</h2>
<p>github：<a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/RangiLyu/nanodet">RangiLyu/nanodet: NanoDet-Plus⚡Super fast and lightweight anchor-free object detection model. 🔥Only 980 KB(int8) / 1.8MB (fp16) and run 97FPS on cellphone🔥</a></p>
<p>CPU：<a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/guo-pu/NanoDet-PyTorch-CPU">guo-pu/NanoDet-PyTorch-CPU: 此代码用于目标检测，模型小，检测速度快速，适合没GPU显卡的嵌入式设备运行，比如“树莓派”、ARM开发板、嵌入式开发板。</a></p>
<p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/hpc203/nanodet-plus-opencv">hpc203/nanodet-plus-opencv: 分别使用OpenCV、ONNXRuntime部署NanoDet-Plus，包含C++和Python两个版本的程序</a></p>
<p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://blog.csdn.net/qq_40280673/article/details/126097822">目标检测——使用nanodet训练自己制作的数据集并测试模型，通俗易懂（详细图文教程）_nanodet训练自己的模型-CSDN博客</a></p>
<p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://blog.csdn.net/matken/article/details/116212274">第一模块：深度学习轻量级模型nanodet-CSDN博客</a></p>
<p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://blog.csdn.net/qq_20144897/article/details/132071736">轻量级目标检测模型NanoDet-Plus微调、部署（保姆级教学）-CSDN博客</a></p>
<p>数据集：</p>
<p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://blog.csdn.net/qq_40280673/article/details/125158582?spm=1001.2014.3001.5501">使用Labelimg制作VOC格式数据集或yolo格式数据集（详细图文教程）_yolov5训练集-CSDN博客</a></p>
<h3 id="conda">conda</h3>
<p>安装<a target="_blank" rel="noopener external nofollow noreferrer" href="https://blog.csdn.net/qq_44000789/article/details/142214660">最新版最详细Anaconda新手安装+配置+环境创建教程_anaconda配置-CSDN博客</a></p>
<p>添加环境变量</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">..\anaconda3</span><br><span class="line">..\anaconda3\Scripts</span><br><span class="line">..\anaconda3\Library\bin</span><br><span class="line">..\anaconda3\Library\mingw-w64\bin</span><br></pre></td></tr></table></figure>
<p>查看安装情况</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">conda --version</span><br></pre></td></tr></table></figure>
<p>创建/删除 环境<br>
命令创建python版本为X.X、名字为 env_name 的虚拟环境。env_name文件可以在Anaconda安装目录 envs文件下找到。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">conda create -n env_name python=3.8</span><br></pre></td></tr></table></figure>
<p>在conda环境下，输入以下命令查看当前存在的环境：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">conda env list</span><br></pre></td></tr></table></figure>
<p>删除环境</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">conda remove -n env_name --all</span><br><span class="line">conda env remove -n env_name</span><br></pre></td></tr></table></figure>
<p>重命名环境（将 --clone 后面的环境重命名成 -n 后面的名字）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">conda create -n torch --clone py3  	# 将 py3 重命名为 torch</span><br></pre></td></tr></table></figure>
<p>创建完成环境之后，系统会提示如何 进入和退出环境，如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">conda activate env_name  		# 进入环境</span><br><span class="line">conda deactivate				# 退出环境</span><br></pre></td></tr></table></figure>
<h3 id="pytorch">pytorch</h3>
<p>查看CUDA版本<code>nvidia-smi</code>  <code>nvcc -V</code></p>
<p><img src="https://cdn.ziyourufeng.eu.org/51hhh/img_bed/main/img/2025/04_22/image_0e05798a1db1a1845db45c9b9cf289ac.png" alt=""></p>
<p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://pytorch.org/get-started/previous-versions/">Previous PyTorch Versions | PyTorch</a></p>
<p><img src="https://cdn.ziyourufeng.eu.org/51hhh/img_bed/main/img/2025/04_22/image_2e2c39973a8d9595cdef7da1ad960c9d.png" alt=""></p>
<p>NanoDet项目需要使用不高于2.00版本的Pytorch,而Pytorch低版本安装需要降低CUDA版本，需要重新安装CUDA 11.7</p>
<p>CUDA旧版存档：<a target="_blank" rel="noopener external nofollow noreferrer" href="https://developer.nvidia.com/cuda-toolkit-archive">CUDA Toolkit Archive | NVIDIA Developer</a></p>
<p><img src="https://cdn.ziyourufeng.eu.org/51hhh/img_bed/main/img/2025/07_23/image_8ce31c74ae67ded441bad2d05b0b6071.png" alt=""></p>
<p>在下载安装过程中，将<code>https://developer.download.nvidia.com</code>改为<code>https://developer.download.nvidia.cn</code>可以解决下载速度过慢的问题。</p>
<p>最后安装<code>sudo apt-get -y install cuda</code>的过程中，也可以在<code>/etc/apt/sources.list.d</code>修改</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo nano archive_uri-https_developer_download_nvidia_com_compute_cuda_repos_ubuntu2204_x86_64_-jammy.list</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.ziyourufeng.eu.org/51hhh/img_bed/main/img/2025/07_23/image_b74e1d6156a10e29edd2af47ba8a6bfd.png" alt=""></p>
<p><img src="https://cdn.ziyourufeng.eu.org/51hhh/img_bed/main/img/2025/07_23/image_674c33632bbea8efc1ca2fe6a515260b.png" alt=""></p>
<p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://zhuanlan.zhihu.com/p/689645505">成功解决：AssertionError: Torch not compiled with CUDA enabled - 知乎</a></p>
<p>创建conda环境</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">conda create -n env_name python=3.8</span><br></pre></td></tr></table></figure>
<p>查看环境</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">conda env list</span><br></pre></td></tr></table></figure>
<p>进入环境</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">conda activate PyTorch</span><br></pre></td></tr></table></figure>
<p>安装pytorch</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">conda install pytorch==1.13.1 torchvision==0.14.1 torchaudio==0.13.1 pytorch-cuda=11.7 -c pytorch -c nvidia</span><br></pre></td></tr></table></figure>
<p>测试torch环境</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">import torch</span><br><span class="line">print(torch.cuda.is_available())</span><br><span class="line">print(torch.cuda.device_count())</span><br><span class="line">print(torch.cuda.get_device_name(0))</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.ziyourufeng.eu.org/51hhh/img_bed/main/img/2025/04_22/image_7fcddf1e8cf1fb014c7aad22a982b215.png" alt=""></p>
<h3 id="NanoDet">NanoDet</h3>
<p>此处使用<a target="_blank" rel="noopener external nofollow noreferrer" href="https://blog.csdn.net/qq_40280673/article/details/126097822">目标检测——使用nanodet训练自己制作的数据集并测试模型，通俗易懂（详细图文教程）_nanodet训练自己的模型-CSDN博客</a></p>
<p>整合文件链接：<a target="_blank" rel="noopener external nofollow noreferrer" href="https://pan.baidu.com/s/1H_qB7OZKJodtbEImKN_TeQ">https://pan.baidu.com/s/1H_qB7OZKJodtbEImKN_TeQ</a> 提取码：dcj7</p>
<p><img src="https://cdn.ziyourufeng.eu.org/51hhh/img_bed/main/img/2025/05_13/image_f986db621ae6ad52f12110db503a852a.png" alt=""></p>
<p><img src="https://cdn.ziyourufeng.eu.org/51hhh/img_bed/main/img/2025/04_21/image_0c30330781f307aec3ea2ae42aa58e1c.png" alt=""></p>
<p>NanoDet项目较早需要使用不高于2.00版本的Pytorch，高版本Pytorch去除了部分NanoDet所用方法</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">conda install pytorch==1.13.1 torchvision==0.14.1 torchaudio==0.13.1 pytorch-cuda=11.7 -c pytorch -c nvidia</span><br></pre></td></tr></table></figure>
<p>注意pytorch与torchvision版本对应</p>
<p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/pytorch/vision#installation">pytorch/vision：特定于计算机视觉的数据集、转换和模型</a></p>
<p>截至现在25/04/22，由于requirements.txt中未对依赖库做版本限制，会导致安装最新稳定版本，导致NanoDet缺少方法，建议以下库指定版本安装</p>
<p>pytorch-lightning  = 1.1.8</p>
<p><img src="https://cdn.ziyourufeng.eu.org/51hhh/img_bed/main/img/2025/04_22/image_a73a48a85f27082f666bfe038500321f.png" alt="现使用版本"></p>
<p>（图中版本还是过高，在后期train中无法正常允许，需使用1.1.8版本）</p>
<p>修改requirements.txt</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">Cython</span><br><span class="line">matplotlib</span><br><span class="line">numpy</span><br><span class="line">omegaconf&gt;=2.0.1</span><br><span class="line">onnx</span><br><span class="line">onnx-simplifier</span><br><span class="line">opencv-python</span><br><span class="line">pyaml</span><br><span class="line">pycocotools</span><br><span class="line">pytorch-lightning==1.1.8</span><br><span class="line">tabulate</span><br><span class="line">tensorboard</span><br><span class="line">termcolor</span><br><span class="line">tqdm</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>安装</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install -r requirements.txt</span><br></pre></td></tr></table></figure>
<p>在项目根目录安装nanodet</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python setup.py develop</span><br></pre></td></tr></table></figure>
<p>下载模型，测试NanoDet</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python demo/demo.py video --config ./config/nanodet-plus-m-1.5x_320.yml --model ./model/nanodet-plus-m-1.5x_320.pth --path ./Video/dai.avi </span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.ziyourufeng.eu.org/51hhh/img_bed/main/img/2025/04_22/image_045cb710e810fb1da721bf3432cf9520.png" alt=""></p>
<p>到此环境完成配置</p>
<h3 id="自训练模型">自训练模型</h3>
<h4 id="数据集准备">数据集准备</h4>
<p>数据标注工具</p>
<p>labelme：</p>
<p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/wkentaro/labelme/releases?page=1">Releases · wkentaro/labelme</a></p>
<p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://zhuanlan.zhihu.com/p/371756150">深度学习图像标签标注软件labelme超详细教程 - 知乎</a></p>
<p>labelimg：</p>
<p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://blog.csdn.net/qq_40280673/article/details/125158582?spm=1001.2014.3001.5501">使用Labelimg制作VOC格式数据集或yolo格式数据集（详细图文教程）_yolov5训练集-CSDN博客</a></p>
<p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://zhuanlan.zhihu.com/p/550021453">【教程】标注工具Labelimg的安装与使用 - 知乎</a></p>
<p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://blog.csdn.net/StopAndGoyyy/article/details/139906637">深度学习工具|LabelImg（标注工具）的安装与使用教程_labelimg软件-CSDN博客</a></p>
<p><img src="https://cdn.ziyourufeng.eu.org/51hhh/img_bed/main/img/2025/05_13/image_c31b4e35dad48e06b66c68ede121fb5b.png" alt=""></p>
<p>先用labelimg或者labelme标注出数据集，数据量过少可以用数据增强生成增加数据量，按照脚本可得到数据增强后的images和xml，分别为图片和目标位置信息。</p>
<p><img src="https://cdn.ziyourufeng.eu.org/51hhh/img_bed/main/img/2025/05_13/image_01119ce0a795e2066bf8d343c5c425dc.png" alt=""></p>
<p>xml文件记录了图片名称和标注目标名称及在图片中的位置。</p>
<p>可以使用下面代码转化labelme到labelimg的xml格式</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># jsonTOxml.py</span></span><br><span class="line"><span class="comment"># 用于将labelme标注的json文件转换为labelimg的VOC格式的xml文件</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> xml.etree.ElementTree <span class="keyword">as</span> ET</span><br><span class="line"><span class="keyword">from</span> xml.dom <span class="keyword">import</span> minidom</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">json_to_xml</span>(<span class="params">json_path, xml_dir</span>):</span><br><span class="line">    <span class="comment"># 读取json文件</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(json_path, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        data = json.load(f)</span><br><span class="line">  </span><br><span class="line">    <span class="comment"># 创建XML结构</span></span><br><span class="line">    annotation = ET.Element(<span class="string">&#x27;annotation&#x27;</span>)</span><br><span class="line">  </span><br><span class="line">    <span class="comment"># 添加文件夹信息</span></span><br><span class="line">    folder = ET.SubElement(annotation, <span class="string">&#x27;folder&#x27;</span>)</span><br><span class="line">    folder.text = <span class="string">&#x27;images&#x27;</span></span><br><span class="line">  </span><br><span class="line">    <span class="comment"># 添加文件名</span></span><br><span class="line">    filename = ET.SubElement(annotation, <span class="string">&#x27;filename&#x27;</span>)</span><br><span class="line">    filename.text = data[<span class="string">&#x27;imagePath&#x27;</span>]</span><br><span class="line">  </span><br><span class="line">    <span class="comment"># 添加路径</span></span><br><span class="line">    path = ET.SubElement(annotation, <span class="string">&#x27;path&#x27;</span>)</span><br><span class="line">    path.text = os.path.abspath(os.path.join(xml_dir, data[<span class="string">&#x27;imagePath&#x27;</span>]))</span><br><span class="line">  </span><br><span class="line">    <span class="comment"># 添加来源信息</span></span><br><span class="line">    source = ET.SubElement(annotation, <span class="string">&#x27;source&#x27;</span>)</span><br><span class="line">    database = ET.SubElement(source, <span class="string">&#x27;database&#x27;</span>)</span><br><span class="line">    database.text = <span class="string">&#x27;Unknown&#x27;</span></span><br><span class="line">  </span><br><span class="line">    <span class="comment"># 添加图片尺寸</span></span><br><span class="line">    size = ET.SubElement(annotation, <span class="string">&#x27;size&#x27;</span>)</span><br><span class="line">    width = ET.SubElement(size, <span class="string">&#x27;width&#x27;</span>)</span><br><span class="line">    width.text = <span class="built_in">str</span>(data[<span class="string">&#x27;imageWidth&#x27;</span>])</span><br><span class="line">    height = ET.SubElement(size, <span class="string">&#x27;height&#x27;</span>)</span><br><span class="line">    height.text = <span class="built_in">str</span>(data[<span class="string">&#x27;imageHeight&#x27;</span>])</span><br><span class="line">    depth = ET.SubElement(size, <span class="string">&#x27;depth&#x27;</span>)</span><br><span class="line">    depth.text = <span class="string">&#x27;3&#x27;</span></span><br><span class="line">  </span><br><span class="line">    <span class="comment"># 添加分割信息</span></span><br><span class="line">    segmented = ET.SubElement(annotation, <span class="string">&#x27;segmented&#x27;</span>)</span><br><span class="line">    segmented.text = <span class="string">&#x27;0&#x27;</span></span><br><span class="line">  </span><br><span class="line">    <span class="comment"># 处理每个标注形状</span></span><br><span class="line">    <span class="keyword">for</span> shape <span class="keyword">in</span> data[<span class="string">&#x27;shapes&#x27;</span>]:</span><br><span class="line">        obj = ET.SubElement(annotation, <span class="string">&#x27;object&#x27;</span>)</span><br><span class="line">  </span><br><span class="line">        <span class="comment"># 添加对象名称</span></span><br><span class="line">        name = ET.SubElement(obj, <span class="string">&#x27;name&#x27;</span>)</span><br><span class="line">        name.text = shape[<span class="string">&#x27;label&#x27;</span>]</span><br><span class="line">  </span><br><span class="line">        <span class="comment"># 添加姿态信息</span></span><br><span class="line">        pose = ET.SubElement(obj, <span class="string">&#x27;pose&#x27;</span>)</span><br><span class="line">        pose.text = <span class="string">&#x27;Unspecified&#x27;</span></span><br><span class="line">  </span><br><span class="line">        <span class="comment"># 添加截断信息</span></span><br><span class="line">        truncated = ET.SubElement(obj, <span class="string">&#x27;truncated&#x27;</span>)</span><br><span class="line">        truncated.text = <span class="string">&#x27;0&#x27;</span></span><br><span class="line">  </span><br><span class="line">        <span class="comment"># 添加难度信息</span></span><br><span class="line">        difficult = ET.SubElement(obj, <span class="string">&#x27;difficult&#x27;</span>)</span><br><span class="line">        difficult.text = <span class="string">&#x27;0&#x27;</span></span><br><span class="line">  </span><br><span class="line">        <span class="comment"># 添加边界框</span></span><br><span class="line">        bndbox = ET.SubElement(obj, <span class="string">&#x27;bndbox&#x27;</span>)</span><br><span class="line">  </span><br><span class="line">        <span class="comment"># 计算边界框坐标</span></span><br><span class="line">        points = shape[<span class="string">&#x27;points&#x27;</span>]</span><br><span class="line">        xmin = ET.SubElement(bndbox, <span class="string">&#x27;xmin&#x27;</span>)</span><br><span class="line">        xmin.text = <span class="built_in">str</span>(<span class="built_in">int</span>(<span class="built_in">min</span>(p[<span class="number">0</span>] <span class="keyword">for</span> p <span class="keyword">in</span> points)))</span><br><span class="line">        ymin = ET.SubElement(bndbox, <span class="string">&#x27;ymin&#x27;</span>)</span><br><span class="line">        ymin.text = <span class="built_in">str</span>(<span class="built_in">int</span>(<span class="built_in">min</span>(p[<span class="number">1</span>] <span class="keyword">for</span> p <span class="keyword">in</span> points)))</span><br><span class="line">        xmax = ET.SubElement(bndbox, <span class="string">&#x27;xmax&#x27;</span>)</span><br><span class="line">        xmax.text = <span class="built_in">str</span>(<span class="built_in">int</span>(<span class="built_in">max</span>(p[<span class="number">0</span>] <span class="keyword">for</span> p <span class="keyword">in</span> points)))</span><br><span class="line">        ymax = ET.SubElement(bndbox, <span class="string">&#x27;ymax&#x27;</span>)</span><br><span class="line">        ymax.text = <span class="built_in">str</span>(<span class="built_in">int</span>(<span class="built_in">max</span>(p[<span class="number">1</span>] <span class="keyword">for</span> p <span class="keyword">in</span> points)))</span><br><span class="line">  </span><br><span class="line">    <span class="comment"># 创建ElementTree对象</span></span><br><span class="line">    tree = ET.ElementTree(annotation)</span><br><span class="line">  </span><br><span class="line">    <span class="comment"># 写入XML文件（不包含XML声明）</span></span><br><span class="line">    xml_filename = os.path.splitext(data[<span class="string">&#x27;imagePath&#x27;</span>])[<span class="number">0</span>] + <span class="string">&#x27;.xml&#x27;</span></span><br><span class="line">    xml_path = os.path.join(xml_dir, xml_filename)</span><br><span class="line">  </span><br><span class="line">    <span class="comment"># 设置缩进并写入文件</span></span><br><span class="line">    ET.indent(tree, space=<span class="string">&quot;  &quot;</span>)</span><br><span class="line">    tree.write(xml_path, encoding=<span class="string">&#x27;utf-8&#x27;</span>, xml_declaration=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">convert_all_json</span>(<span class="params">json_dir, xml_dir</span>):</span><br><span class="line">    <span class="comment"># 确保输出目录存在</span></span><br><span class="line">    os.makedirs(xml_dir, exist_ok=<span class="literal">True</span>)</span><br><span class="line">  </span><br><span class="line">    <span class="comment"># 遍历json目录下所有.json文件</span></span><br><span class="line">    <span class="keyword">for</span> filename <span class="keyword">in</span> os.listdir(json_dir):</span><br><span class="line">        <span class="keyword">if</span> filename.endswith(<span class="string">&#x27;.json&#x27;</span>):</span><br><span class="line">            json_path = os.path.join(json_dir, filename)</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                json_to_xml(json_path, xml_dir)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&#x27;Converted <span class="subst">&#123;filename&#125;</span> successfully&#x27;</span>)</span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&#x27;Failed to convert <span class="subst">&#123;filename&#125;</span>: <span class="subst">&#123;<span class="built_in">str</span>(e)&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="comment"># 设置输入输出目录</span></span><br><span class="line">    input_dir = <span class="string">&#x27;json&#x27;</span></span><br><span class="line">    output_dir = <span class="string">&#x27;xml&#x27;</span></span><br><span class="line">  </span><br><span class="line">    <span class="comment"># 执行转换</span></span><br><span class="line">    convert_all_json(input_dir, output_dir)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>以下是具体流程。</p>
<p>数据增强，旋转，翻转，裁剪，噪声，提高模型泛化能力，防止过拟合，添加训练数据量</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># zengqiang.py</span></span><br><span class="line"><span class="comment"># 数据增强</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> xml.etree.ElementTree <span class="keyword">as</span> ET</span><br><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> os <span class="keyword">import</span> getcwd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"><span class="keyword">import</span> shutil</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> imgaug <span class="keyword">as</span> ia</span><br><span class="line"><span class="keyword">from</span> imgaug <span class="keyword">import</span> augmenters <span class="keyword">as</span> iaa</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ia.seed(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read_xml_annotation</span>(<span class="params">root, image_id</span>):</span><br><span class="line">    in_file = <span class="built_in">open</span>(os.path.join(root, image_id))</span><br><span class="line">    tree = ET.parse(in_file)</span><br><span class="line">    root = tree.getroot()</span><br><span class="line">    bndboxlist = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> <span class="built_in">object</span> <span class="keyword">in</span> root.findall(<span class="string">&#x27;object&#x27;</span>):  <span class="comment"># 找到root节点下的所有country节点</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">object</span> <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:  <span class="comment"># 添加这个检查</span></span><br><span class="line">            bndbox = <span class="built_in">object</span>.find(<span class="string">&#x27;bndbox&#x27;</span>)  <span class="comment"># 子节点下节点rank的值</span></span><br><span class="line"></span><br><span class="line">            xmin = <span class="built_in">int</span>(bndbox.find(<span class="string">&#x27;xmin&#x27;</span>).text)</span><br><span class="line">            xmax = <span class="built_in">int</span>(bndbox.find(<span class="string">&#x27;xmax&#x27;</span>).text)</span><br><span class="line">            ymin = <span class="built_in">int</span>(bndbox.find(<span class="string">&#x27;ymin&#x27;</span>).text)</span><br><span class="line">            ymax = <span class="built_in">int</span>(bndbox.find(<span class="string">&#x27;ymax&#x27;</span>).text)</span><br><span class="line">            <span class="comment"># print(xmin,ymin,xmax,ymax)</span></span><br><span class="line">            bndboxlist.append([xmin, ymin, xmax, ymax])</span><br><span class="line">            <span class="comment"># print(bndboxlist)</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> bndboxlist:</span><br><span class="line">        <span class="keyword">return</span> []</span><br><span class="line"></span><br><span class="line">    bndbox = root.find(<span class="string">&#x27;object&#x27;</span>).find(<span class="string">&#x27;bndbox&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> bndboxlist</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># (506.0000, 330.0000, 528.0000, 348.0000) -&gt; (520.4747, 381.5080, 540.5596, 398.6603)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">change_xml_annotation</span>(<span class="params">root, image_id, new_target</span>):</span><br><span class="line">    new_xmin = new_target[<span class="number">0</span>]</span><br><span class="line">    new_ymin = new_target[<span class="number">1</span>]</span><br><span class="line">    new_xmax = new_target[<span class="number">2</span>]</span><br><span class="line">    new_ymax = new_target[<span class="number">3</span>]</span><br><span class="line"></span><br><span class="line">    in_file = <span class="built_in">open</span>(os.path.join(root, <span class="built_in">str</span>(image_id) + <span class="string">&#x27;.xml&#x27;</span>))  <span class="comment"># 这里root分别由两个意思</span></span><br><span class="line">    tree = ET.parse(in_file)</span><br><span class="line">    xmlroot = tree.getroot()</span><br><span class="line">    <span class="built_in">object</span> = xmlroot.find(<span class="string">&#x27;object&#x27;</span>)</span><br><span class="line">    bndbox = <span class="built_in">object</span>.find(<span class="string">&#x27;bndbox&#x27;</span>)</span><br><span class="line">    xmin = bndbox.find(<span class="string">&#x27;xmin&#x27;</span>)</span><br><span class="line">    xmin.text = <span class="built_in">str</span>(new_xmin)</span><br><span class="line">    ymin = bndbox.find(<span class="string">&#x27;ymin&#x27;</span>)</span><br><span class="line">    ymin.text = <span class="built_in">str</span>(new_ymin)</span><br><span class="line">    xmax = bndbox.find(<span class="string">&#x27;xmax&#x27;</span>)</span><br><span class="line">    xmax.text = <span class="built_in">str</span>(new_xmax)</span><br><span class="line">    ymax = bndbox.find(<span class="string">&#x27;ymax&#x27;</span>)</span><br><span class="line">    ymax.text = <span class="built_in">str</span>(new_ymax)</span><br><span class="line">    tree.write(os.path.join(root, <span class="built_in">str</span>(<span class="string">&quot;%06d&quot;</span> % (<span class="built_in">str</span>(<span class="built_in">id</span>) + <span class="string">&#x27;.xml&#x27;</span>))))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">change_xml_list_annotation</span>(<span class="params">root, image_id, new_target, saveroot, <span class="built_in">id</span>,img_name</span>):</span><br><span class="line">    in_file = <span class="built_in">open</span>(os.path.join(root, <span class="built_in">str</span>(image_id) + <span class="string">&#x27;.xml&#x27;</span>))  <span class="comment"># 这里root分别由两个意思</span></span><br><span class="line">    tree = ET.parse(in_file)</span><br><span class="line">    elem = tree.find(<span class="string">&#x27;filename&#x27;</span>)</span><br><span class="line">    elem.text = (img_name + <span class="built_in">str</span>(<span class="string">&quot;_%06d&quot;</span> % <span class="built_in">int</span>(<span class="built_in">id</span>)) + <span class="string">&#x27;.jpg&#x27;</span>)</span><br><span class="line">    xmlroot = tree.getroot()</span><br><span class="line">    index = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> <span class="built_in">object</span> <span class="keyword">in</span> xmlroot.findall(<span class="string">&#x27;object&#x27;</span>):  <span class="comment"># 找到root节点下的所有country节点</span></span><br><span class="line">        bndbox = <span class="built_in">object</span>.find(<span class="string">&#x27;bndbox&#x27;</span>)  <span class="comment"># 子节点下节点rank的值</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># xmin = int(bndbox.find(&#x27;xmin&#x27;).text)</span></span><br><span class="line">        <span class="comment"># xmax = int(bndbox.find(&#x27;xmax&#x27;).text)</span></span><br><span class="line">        <span class="comment"># ymin = int(bndbox.find(&#x27;ymin&#x27;).text)</span></span><br><span class="line">        <span class="comment"># ymax = int(bndbox.find(&#x27;ymax&#x27;).text)</span></span><br><span class="line"></span><br><span class="line">        new_xmin = new_target[index][<span class="number">0</span>]</span><br><span class="line">        new_ymin = new_target[index][<span class="number">1</span>]</span><br><span class="line">        new_xmax = new_target[index][<span class="number">2</span>]</span><br><span class="line">        new_ymax = new_target[index][<span class="number">3</span>]</span><br><span class="line"></span><br><span class="line">        xmin = bndbox.find(<span class="string">&#x27;xmin&#x27;</span>)</span><br><span class="line">        xmin.text = <span class="built_in">str</span>(new_xmin)</span><br><span class="line">        ymin = bndbox.find(<span class="string">&#x27;ymin&#x27;</span>)</span><br><span class="line">        ymin.text = <span class="built_in">str</span>(new_ymin)</span><br><span class="line">        xmax = bndbox.find(<span class="string">&#x27;xmax&#x27;</span>)</span><br><span class="line">        xmax.text = <span class="built_in">str</span>(new_xmax)</span><br><span class="line">        ymax = bndbox.find(<span class="string">&#x27;ymax&#x27;</span>)</span><br><span class="line">        ymax.text = <span class="built_in">str</span>(new_ymax)</span><br><span class="line"></span><br><span class="line">        index = index + <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    tree.write(os.path.join(saveroot, img_name + <span class="built_in">str</span>(<span class="string">&quot;_%06d&quot;</span> % <span class="built_in">int</span>(<span class="built_in">id</span>)) + <span class="string">&#x27;.xml&#x27;</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">mkdir</span>(<span class="params">path</span>):</span><br><span class="line">    <span class="comment"># 去除首位空格</span></span><br><span class="line">    path = path.strip()</span><br><span class="line">    <span class="comment"># 去除尾部 \ 符号</span></span><br><span class="line">    path = path.rstrip(<span class="string">&quot;\\&quot;</span>)</span><br><span class="line">    <span class="comment"># 判断路径是否存在</span></span><br><span class="line">    <span class="comment"># 存在     True</span></span><br><span class="line">    <span class="comment"># 不存在   False</span></span><br><span class="line">    isExists = os.path.exists(path)</span><br><span class="line">    <span class="comment"># 判断结果</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> isExists:</span><br><span class="line">        <span class="comment"># 如果不存在则创建目录</span></span><br><span class="line">        <span class="comment"># 创建目录操作函数</span></span><br><span class="line">        os.makedirs(path)</span><br><span class="line">        <span class="built_in">print</span>(path + <span class="string">&#x27; 创建成功&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="comment"># 如果目录存在则不创建，并提示目录已存在</span></span><br><span class="line">        <span class="built_in">print</span>(path + <span class="string">&#x27; 目录已存在&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line"></span><br><span class="line">    IMG_DIR = <span class="string">&quot;./images&quot;</span>             <span class="comment">### 原始数据集图像的路径</span></span><br><span class="line">    XML_DIR = <span class="string">&quot;./Annotations&quot;</span>              <span class="comment">### 原始xml文件的路径</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># =============================================================================</span></span><br><span class="line"><span class="comment">#     AUG_XML_DIR = &quot;./Annotations&quot;  # 存储增强后的XML文件夹路径</span></span><br><span class="line"><span class="comment"># =============================================================================</span></span><br><span class="line">    AUG_XML_DIR = <span class="string">&quot;./val Enhance/xml&quot;</span>              <span class="comment">### 数据增强后的xml文件的保存路径</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        shutil.rmtree(AUG_XML_DIR)</span><br><span class="line">    <span class="keyword">except</span> FileNotFoundError <span class="keyword">as</span> e:</span><br><span class="line">        a = <span class="number">1</span></span><br><span class="line">    mkdir(AUG_XML_DIR)</span><br><span class="line"></span><br><span class="line"><span class="comment"># =============================================================================</span></span><br><span class="line"><span class="comment">#     AUG_IMG_DIR = &quot;./JPEGImages&quot;  # 存储增强后的影像文件夹路径</span></span><br><span class="line"><span class="comment"># =============================================================================</span></span><br><span class="line">    AUG_IMG_DIR = <span class="string">&quot;./val Enhance/images&quot;</span>  <span class="comment">### 数据增强后图片的保存路径</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        shutil.rmtree(AUG_IMG_DIR)</span><br><span class="line">    <span class="keyword">except</span> FileNotFoundError <span class="keyword">as</span> e:</span><br><span class="line">        a = <span class="number">1</span></span><br><span class="line">    mkdir(AUG_IMG_DIR)</span><br><span class="line"></span><br><span class="line">    AUGLOOP = <span class="number">5</span>  <span class="comment"># 每张影像增强的数量</span></span><br><span class="line"></span><br><span class="line">    boxes_img_aug_list = []</span><br><span class="line">    new_bndbox = []</span><br><span class="line">    new_bndbox_list = []</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line">    <span class="comment"># 影像增强序列配置</span></span><br><span class="line">    seq = iaa.Sequential([</span><br><span class="line">        <span class="comment"># 几何变换增强</span></span><br><span class="line">        iaa.Flipud(<span class="number">0.5</span>),  <span class="comment"># 垂直翻转，50%概率</span></span><br><span class="line">        iaa.Fliplr(<span class="number">0.5</span>),  <span class="comment"># 水平镜像翻转，50%概率</span></span><br><span class="line">  </span><br><span class="line">        <span class="comment"># 颜色空间变换增强</span></span><br><span class="line">        iaa.Multiply((<span class="number">1.2</span>, <span class="number">1.5</span>)),  <span class="comment"># 亮度调整，1.2-1.5倍随机</span></span><br><span class="line">        iaa.AddToHueAndSaturation((-<span class="number">20</span>, <span class="number">20</span>)),  <span class="comment"># 色相和饱和度调整，±20随机值</span></span><br><span class="line">        iaa.LinearContrast((<span class="number">0.8</span>, <span class="number">1.2</span>)),  <span class="comment"># 对比度调整，0.8-1.2倍随机</span></span><br><span class="line">  </span><br><span class="line">        <span class="comment"># 噪声和模糊增强</span></span><br><span class="line">        iaa.GaussianBlur(sigma=(<span class="number">0</span>, <span class="number">3.0</span>)),  <span class="comment"># 高斯模糊，sigma值0-3随机</span></span><br><span class="line">        iaa.AdditiveGaussianNoise(scale=(<span class="number">0</span>, <span class="number">0.05</span>*<span class="number">255</span>)),  <span class="comment"># 高斯噪声，强度0-5%随机</span></span><br><span class="line">  </span><br><span class="line">        <span class="comment"># 仿射变换增强</span></span><br><span class="line">        iaa.Affine(</span><br><span class="line">            translate_px=&#123;<span class="string">&quot;x&quot;</span>: <span class="number">15</span>, <span class="string">&quot;y&quot;</span>: <span class="number">15</span>&#125;,  <span class="comment"># 平移变换，x/y方向各15像素</span></span><br><span class="line">            scale=(<span class="number">0.8</span>, <span class="number">0.95</span>),  <span class="comment"># 缩放变换，0.8-0.95倍随机</span></span><br><span class="line">            rotate=(-<span class="number">30</span>, <span class="number">30</span>)  <span class="comment"># 旋转变换，-30到30度随机</span></span><br><span class="line">        )</span><br><span class="line">    ])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> root, sub_folders, files <span class="keyword">in</span> os.walk(XML_DIR):</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> name <span class="keyword">in</span> files:</span><br><span class="line">            <span class="built_in">print</span>(name)</span><br><span class="line">            bndbox = read_xml_annotation(XML_DIR, name)</span><br><span class="line">            shutil.copy(os.path.join(XML_DIR, name), AUG_XML_DIR)</span><br><span class="line">            shutil.copy(os.path.join(IMG_DIR, name[:-<span class="number">4</span>] + <span class="string">&#x27;.jpg&#x27;</span>), AUG_IMG_DIR)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> epoch <span class="keyword">in</span> <span class="built_in">range</span>(AUGLOOP):</span><br><span class="line">                seq_det = seq.to_deterministic()  <span class="comment"># 保持坐标和图像同步改变，而不是随机</span></span><br><span class="line">                <span class="comment"># 读取图片</span></span><br><span class="line">                img = Image.<span class="built_in">open</span>(os.path.join(IMG_DIR, name[:-<span class="number">4</span>] + <span class="string">&#x27;.jpg&#x27;</span>))</span><br><span class="line">                <span class="comment"># sp = img.size</span></span><br><span class="line">                img = np.asarray(img)</span><br><span class="line">                <span class="comment"># bndbox 坐标增强</span></span><br><span class="line">                <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(bndbox)):</span><br><span class="line">                    bbs = ia.BoundingBoxesOnImage([</span><br><span class="line">                        ia.BoundingBox(x1=bndbox[i][<span class="number">0</span>], y1=bndbox[i][<span class="number">1</span>], x2=bndbox[i][<span class="number">2</span>], y2=bndbox[i][<span class="number">3</span>]),</span><br><span class="line">                    ], shape=img.shape)</span><br><span class="line"></span><br><span class="line">                    bbs_aug = seq_det.augment_bounding_boxes([bbs])[<span class="number">0</span>]</span><br><span class="line">                    boxes_img_aug_list.append(bbs_aug)</span><br><span class="line"></span><br><span class="line">                    <span class="comment"># new_bndbox_list:[[x1,y1,x2,y2],...[],[]]</span></span><br><span class="line">                    n_x1 = <span class="built_in">int</span>(<span class="built_in">max</span>(<span class="number">1</span>, <span class="built_in">min</span>(img.shape[<span class="number">1</span>], bbs_aug.bounding_boxes[<span class="number">0</span>].x1)))</span><br><span class="line">                    n_y1 = <span class="built_in">int</span>(<span class="built_in">max</span>(<span class="number">1</span>, <span class="built_in">min</span>(img.shape[<span class="number">0</span>], bbs_aug.bounding_boxes[<span class="number">0</span>].y1)))</span><br><span class="line">                    n_x2 = <span class="built_in">int</span>(<span class="built_in">max</span>(<span class="number">1</span>, <span class="built_in">min</span>(img.shape[<span class="number">1</span>], bbs_aug.bounding_boxes[<span class="number">0</span>].x2)))</span><br><span class="line">                    n_y2 = <span class="built_in">int</span>(<span class="built_in">max</span>(<span class="number">1</span>, <span class="built_in">min</span>(img.shape[<span class="number">0</span>], bbs_aug.bounding_boxes[<span class="number">0</span>].y2)))</span><br><span class="line">                    <span class="keyword">if</span> n_x1 == <span class="number">1</span> <span class="keyword">and</span> n_x1 == n_x2:</span><br><span class="line">                        n_x2 += <span class="number">1</span></span><br><span class="line">                    <span class="keyword">if</span> n_y1 == <span class="number">1</span> <span class="keyword">and</span> n_y2 == n_y1:</span><br><span class="line">                        n_y2 += <span class="number">1</span></span><br><span class="line">                    <span class="keyword">if</span> n_x1 &gt;= n_x2 <span class="keyword">or</span> n_y1 &gt;= n_y2:</span><br><span class="line">                        <span class="built_in">print</span>(<span class="string">&#x27;error&#x27;</span>, name)</span><br><span class="line">                    new_bndbox_list.append([n_x1, n_y1, n_x2, n_y2])</span><br><span class="line">                <span class="comment"># 存储变化后的图片</span></span><br><span class="line">                image_aug = seq_det.augment_images([img])[<span class="number">0</span>]</span><br><span class="line">                path = os.path.join(AUG_IMG_DIR,</span><br><span class="line">                                    name[:-<span class="number">4</span>] + <span class="built_in">str</span>( <span class="string">&quot;_%06d&quot;</span> % (epoch + <span class="number">1</span>)) + <span class="string">&#x27;.jpg&#x27;</span>)</span><br><span class="line">                image_auged = bbs.draw_on_image(image_aug, thickness=<span class="number">0</span>)</span><br><span class="line">                Image.fromarray(image_auged).save(path)</span><br><span class="line"></span><br><span class="line">                <span class="comment"># 存储变化后的XML</span></span><br><span class="line">                change_xml_list_annotation(XML_DIR, name[:-<span class="number">4</span>], new_bndbox_list, AUG_XML_DIR,</span><br><span class="line">                                           epoch + <span class="number">1</span>,name[:-<span class="number">4</span>])</span><br><span class="line">                <span class="built_in">print</span>( name[:-<span class="number">4</span>] + <span class="built_in">str</span>( <span class="string">&quot;_%06d&quot;</span> % (epoch + <span class="number">1</span>)) + <span class="string">&#x27;.jpg&#x27;</span>)</span><br><span class="line">                new_bndbox_list = []</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>标注得到的VOC格式数据集转为coco数据集</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># xmlTojson.py</span></span><br><span class="line"><span class="comment"># 用这个将xml转化为json格式可以正常的训练</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> xml.etree.ElementTree <span class="keyword">as</span> ET</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">coco = <span class="built_in">dict</span>()</span><br><span class="line">coco[<span class="string">&#x27;images&#x27;</span>] = []</span><br><span class="line">coco[<span class="string">&#x27;type&#x27;</span>] = <span class="string">&#x27;instances&#x27;</span></span><br><span class="line">coco[<span class="string">&#x27;annotations&#x27;</span>] = []</span><br><span class="line">coco[<span class="string">&#x27;categories&#x27;</span>] = []</span><br><span class="line"></span><br><span class="line">category_set = <span class="built_in">dict</span>()</span><br><span class="line">image_set = <span class="built_in">set</span>()</span><br><span class="line"></span><br><span class="line">category_item_id = <span class="number">0</span></span><br><span class="line"><span class="comment"># image_id = &#x27;ball-&#x27;</span></span><br><span class="line">image_id = <span class="number">0</span></span><br><span class="line">id_num = <span class="number">0</span></span><br><span class="line">annotation_id = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">addCatItem</span>(<span class="params">name</span>):</span><br><span class="line">    <span class="keyword">global</span> category_item_id</span><br><span class="line">    category_item = <span class="built_in">dict</span>()</span><br><span class="line">    category_item[<span class="string">&#x27;supercategory&#x27;</span>] = <span class="string">&#x27;none&#x27;</span></span><br><span class="line">    category_item_id += <span class="number">1</span></span><br><span class="line">    category_item[<span class="string">&#x27;id&#x27;</span>] = category_item_id</span><br><span class="line">    category_item[<span class="string">&#x27;name&#x27;</span>] = name</span><br><span class="line">    coco[<span class="string">&#x27;categories&#x27;</span>].append(category_item)</span><br><span class="line">    category_set[name] = category_item_id</span><br><span class="line">    <span class="keyword">return</span> category_item_id</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">addImgItem</span>(<span class="params">file_name, size</span>):</span><br><span class="line">    <span class="keyword">global</span> image_id, id_num</span><br><span class="line">    <span class="keyword">if</span> file_name <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        <span class="keyword">raise</span> Exception(<span class="string">&#x27;Could not find filename tag in xml file.&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> size[<span class="string">&#x27;width&#x27;</span>] <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        <span class="keyword">raise</span> Exception(<span class="string">&#x27;Could not find width tag in xml file.&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> size[<span class="string">&#x27;height&#x27;</span>] <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        <span class="keyword">raise</span> Exception(<span class="string">&#x27;Could not find height tag in xml file.&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    image_item = <span class="built_in">dict</span>()</span><br><span class="line">    <span class="comment"># temp = str(id_num)</span></span><br><span class="line">    temp = <span class="built_in">int</span>(id_num)</span><br><span class="line">    <span class="comment"># image_item[&#x27;id&#x27;] = image_id + temp</span></span><br><span class="line">    image_item[<span class="string">&#x27;id&#x27;</span>] = temp</span><br><span class="line">    id_num += <span class="number">1</span></span><br><span class="line">    image_item[<span class="string">&#x27;file_name&#x27;</span>] = file_name</span><br><span class="line">    image_item[<span class="string">&#x27;width&#x27;</span>] = size[<span class="string">&#x27;width&#x27;</span>]</span><br><span class="line">    image_item[<span class="string">&#x27;height&#x27;</span>] = size[<span class="string">&#x27;height&#x27;</span>]</span><br><span class="line">    coco[<span class="string">&#x27;images&#x27;</span>].append(image_item)</span><br><span class="line">    image_set.add(file_name)</span><br><span class="line">    <span class="keyword">return</span> image_item[<span class="string">&#x27;id&#x27;</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">addAnnoItem</span>(<span class="params">object_name, image_id, category_id, bbox</span>):</span><br><span class="line">    <span class="keyword">global</span> annotation_id</span><br><span class="line">    annotation_item = <span class="built_in">dict</span>()</span><br><span class="line">    annotation_item[<span class="string">&#x27;segmentation&#x27;</span>] = []</span><br><span class="line">    seg = []</span><br><span class="line">    <span class="comment"># bbox[] is x,y,w,h</span></span><br><span class="line">    <span class="comment"># left_top</span></span><br><span class="line">    seg.append(bbox[<span class="number">0</span>])</span><br><span class="line">    seg.append(bbox[<span class="number">1</span>])</span><br><span class="line">    <span class="comment"># left_bottom</span></span><br><span class="line">    seg.append(bbox[<span class="number">0</span>])</span><br><span class="line">    seg.append(bbox[<span class="number">1</span>] + bbox[<span class="number">3</span>])</span><br><span class="line">    <span class="comment"># right_bottom</span></span><br><span class="line">    seg.append(bbox[<span class="number">0</span>] + bbox[<span class="number">2</span>])</span><br><span class="line">    seg.append(bbox[<span class="number">1</span>] + bbox[<span class="number">3</span>])</span><br><span class="line">    <span class="comment"># right_top</span></span><br><span class="line">    seg.append(bbox[<span class="number">0</span>] + bbox[<span class="number">2</span>])</span><br><span class="line">    seg.append(bbox[<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">    annotation_item[<span class="string">&#x27;segmentation&#x27;</span>].append(seg)</span><br><span class="line"></span><br><span class="line">    annotation_item[<span class="string">&#x27;area&#x27;</span>] = bbox[<span class="number">2</span>] * bbox[<span class="number">3</span>]</span><br><span class="line">    annotation_item[<span class="string">&#x27;iscrowd&#x27;</span>] = <span class="number">0</span></span><br><span class="line">    annotation_item[<span class="string">&#x27;ignore&#x27;</span>] = <span class="number">0</span></span><br><span class="line">    annotation_item[<span class="string">&#x27;image_id&#x27;</span>] = image_id</span><br><span class="line">    annotation_item[<span class="string">&#x27;bbox&#x27;</span>] = bbox</span><br><span class="line">    annotation_item[<span class="string">&#x27;category_id&#x27;</span>] = category_id</span><br><span class="line">    annotation_id += <span class="number">1</span></span><br><span class="line">    annotation_item[<span class="string">&#x27;id&#x27;</span>] = annotation_id</span><br><span class="line">    coco[<span class="string">&#x27;annotations&#x27;</span>].append(annotation_item)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">parseXmlFiles</span>(<span class="params">xml_path</span>):</span><br><span class="line">    <span class="keyword">for</span> f <span class="keyword">in</span> os.listdir(xml_path):</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> f.endswith(<span class="string">&#x27;.xml&#x27;</span>):</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">        bndbox = <span class="built_in">dict</span>()</span><br><span class="line">        size = <span class="built_in">dict</span>()</span><br><span class="line">        current_image_id = <span class="literal">None</span></span><br><span class="line">        current_category_id = <span class="literal">None</span></span><br><span class="line">        file_name = <span class="literal">None</span></span><br><span class="line">        size[<span class="string">&#x27;width&#x27;</span>] = <span class="literal">None</span></span><br><span class="line">        size[<span class="string">&#x27;height&#x27;</span>] = <span class="literal">None</span></span><br><span class="line">        size[<span class="string">&#x27;depth&#x27;</span>] = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">        xml_file = os.path.join(xml_path, f)</span><br><span class="line">        <span class="built_in">print</span>(xml_file)</span><br><span class="line"></span><br><span class="line">        tree = ET.parse(xml_file)</span><br><span class="line">        root = tree.getroot()</span><br><span class="line">        <span class="keyword">if</span> root.tag != <span class="string">&#x27;annotation&#x27;</span>:</span><br><span class="line">            <span class="keyword">raise</span> Exception(<span class="string">&#x27;pascal voc xml root element should be annotation, rather than &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(root.tag))</span><br><span class="line"></span><br><span class="line">        <span class="comment"># elem is &lt;folder&gt;, &lt;filename&gt;, &lt;size&gt;, &lt;object&gt;</span></span><br><span class="line">        <span class="keyword">for</span> elem <span class="keyword">in</span> root:</span><br><span class="line">            current_parent = elem.tag</span><br><span class="line">            current_sub = <span class="literal">None</span></span><br><span class="line">            object_name = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> elem.tag == <span class="string">&#x27;folder&#x27;</span>:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> elem.tag == <span class="string">&#x27;filename&#x27;</span>:</span><br><span class="line">                file_name = elem.text</span><br><span class="line">                <span class="keyword">if</span> file_name <span class="keyword">in</span> category_set:</span><br><span class="line">                    <span class="keyword">raise</span> Exception(<span class="string">&#x27;file_name duplicated&#x27;</span>)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># add img item only after parse &lt;size&gt; tag</span></span><br><span class="line">            <span class="keyword">elif</span> current_image_id <span class="keyword">is</span> <span class="literal">None</span> <span class="keyword">and</span> file_name <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span> <span class="keyword">and</span> size[<span class="string">&#x27;width&#x27;</span>] <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">                <span class="keyword">if</span> file_name <span class="keyword">not</span> <span class="keyword">in</span> image_set:</span><br><span class="line">                    current_image_id = addImgItem(file_name, size)</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&#x27;add image with &#123;&#125; and &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(file_name, size))</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="keyword">raise</span> Exception(<span class="string">&#x27;duplicated image: &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(file_name))</span><br><span class="line">                    <span class="comment"># subelem is &lt;width&gt;, &lt;height&gt;, &lt;depth&gt;, &lt;name&gt;, &lt;bndbox&gt;</span></span><br><span class="line">            <span class="keyword">for</span> subelem <span class="keyword">in</span> elem:</span><br><span class="line">                bndbox[<span class="string">&#x27;xmin&#x27;</span>] = <span class="literal">None</span></span><br><span class="line">                bndbox[<span class="string">&#x27;xmax&#x27;</span>] = <span class="literal">None</span></span><br><span class="line">                bndbox[<span class="string">&#x27;ymin&#x27;</span>] = <span class="literal">None</span></span><br><span class="line">                bndbox[<span class="string">&#x27;ymax&#x27;</span>] = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">                current_sub = subelem.tag</span><br><span class="line">                <span class="keyword">if</span> current_parent == <span class="string">&#x27;object&#x27;</span> <span class="keyword">and</span> subelem.tag == <span class="string">&#x27;name&#x27;</span>:</span><br><span class="line">                    object_name = subelem.text</span><br><span class="line">                    <span class="keyword">if</span> object_name <span class="keyword">not</span> <span class="keyword">in</span> category_set:</span><br><span class="line">                        current_category_id = addCatItem(object_name)</span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        current_category_id = category_set[object_name]</span><br><span class="line"></span><br><span class="line">                <span class="keyword">elif</span> current_parent == <span class="string">&#x27;size&#x27;</span>:</span><br><span class="line">                    <span class="keyword">if</span> size[subelem.tag] <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">                        <span class="keyword">raise</span> Exception(<span class="string">&#x27;xml structure broken at size tag.&#x27;</span>)</span><br><span class="line">                    size[subelem.tag] = <span class="built_in">int</span>(subelem.text)</span><br><span class="line"></span><br><span class="line">                <span class="comment"># option is &lt;xmin&gt;, &lt;ymin&gt;, &lt;xmax&gt;, &lt;ymax&gt;, when subelem is &lt;bndbox&gt;</span></span><br><span class="line">                <span class="keyword">for</span> option <span class="keyword">in</span> subelem:</span><br><span class="line">                    <span class="keyword">if</span> current_sub == <span class="string">&#x27;bndbox&#x27;</span>:</span><br><span class="line">                        <span class="keyword">if</span> bndbox[option.tag] <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">                            <span class="keyword">raise</span> Exception(<span class="string">&#x27;xml structure corrupted at bndbox tag.&#x27;</span>)</span><br><span class="line">                    bndbox[option.tag] = <span class="built_in">int</span>(option.text)</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">f&quot;读取到 <span class="subst">&#123;option.tag&#125;</span>: <span class="subst">&#123;bndbox[option.tag]&#125;</span>&quot;</span>)</span><br><span class="line">  </span><br><span class="line">                <span class="keyword">if</span> current_sub == <span class="string">&#x27;bndbox&#x27;</span>:</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">f&quot;xmin: <span class="subst">&#123;bndbox[<span class="string">&#x27;xmin&#x27;</span>]&#125;</span>, ymin: <span class="subst">&#123;bndbox[<span class="string">&#x27;ymin&#x27;</span>]&#125;</span>, xmax: <span class="subst">&#123;bndbox[<span class="string">&#x27;xmax&#x27;</span>]&#125;</span>, ymax: <span class="subst">&#123;bndbox[<span class="string">&#x27;ymax&#x27;</span>]&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">                <span class="comment"># only after parse the &lt;object&gt; tag</span></span><br><span class="line">                <span class="keyword">if</span> bndbox[<span class="string">&#x27;xmin&#x27;</span>] <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">                    <span class="keyword">if</span> object_name <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">                        <span class="keyword">raise</span> Exception(<span class="string">&#x27;xml structure broken at bndbox tag&#x27;</span>)</span><br><span class="line">                    <span class="keyword">if</span> current_image_id <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">                        <span class="keyword">raise</span> Exception(<span class="string">&#x27;xml structure broken at bndbox tag&#x27;</span>)</span><br><span class="line">                    <span class="keyword">if</span> current_category_id <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">                        <span class="keyword">raise</span> Exception(<span class="string">&#x27;xml structure broken at bndbox tag&#x27;</span>)</span><br><span class="line">                    bbox = []</span><br><span class="line">                    <span class="comment"># x</span></span><br><span class="line">                    bbox.append(bndbox[<span class="string">&#x27;xmin&#x27;</span>])</span><br><span class="line">                    <span class="comment"># y</span></span><br><span class="line">                    bbox.append(bndbox[<span class="string">&#x27;ymin&#x27;</span>])</span><br><span class="line">                    <span class="comment"># w</span></span><br><span class="line">                    width = bndbox[<span class="string">&#x27;xmax&#x27;</span>] - bndbox[<span class="string">&#x27;xmin&#x27;</span>]</span><br><span class="line">                    bbox.append(width)</span><br><span class="line">                    <span class="comment"># h</span></span><br><span class="line">                    height = bndbox[<span class="string">&#x27;ymax&#x27;</span>] - bndbox[<span class="string">&#x27;ymin&#x27;</span>]</span><br><span class="line">                    bbox.append(height)</span><br><span class="line">  </span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">f&quot;width: <span class="subst">&#123;width&#125;</span>, height: <span class="subst">&#123;height&#125;</span>&quot;</span>)</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">f&quot;文件名: <span class="subst">&#123;file_name&#125;</span>, 对象名称: <span class="subst">&#123;object_name&#125;</span>, 计算得到的 bbox: <span class="subst">&#123;bbox&#125;</span>&quot;</span>)</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&#x27;add annotation with &#123;&#125;,&#123;&#125;,&#123;&#125;,&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(object_name, current_image_id, current_category_id,</span><br><span class="line">                                                                   bbox))</span><br><span class="line">                    addAnnoItem(object_name, current_image_id, current_category_id, bbox)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line"></span><br><span class="line">    xml_path = <span class="string">&quot;./val Enhance/xml&quot;</span>  <span class="comment">## 原始的xml文件路径</span></span><br><span class="line">    json_file = <span class="string">&#x27;./nanodet_train_zengqian.json&#x27;</span>  <span class="comment">## 转后保存.json文件的路径</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment"># xml_path = &quot;./Annotations&quot;  ## 原始的xml文件路径</span></span><br><span class="line">    <span class="comment"># json_file = &#x27;./nanodet_train.json&#x27;  ## 转后保存.json文件的路径</span></span><br><span class="line"></span><br><span class="line">    parseXmlFiles(xml_path)</span><br><span class="line">    json.dump(coco, <span class="built_in">open</span>(json_file, <span class="string">&#x27;w&#x27;</span>))</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>将.xml标签文件转化为一个.json文件，用于coco数据集训练。</p>
<p><img src="https://cdn.ziyourufeng.eu.org/51hhh/img_bed/main/img/2025/04_22/image_b048ad7703c2d3e7dfdd2197123cc9ca.png" alt=""></p>
<p><img src="https://cdn.ziyourufeng.eu.org/51hhh/img_bed/main/img/2025/04_22/image_124846923aa4cec3a30c9302048bbfa8.png" alt=""></p>
<p>查看标注框是否正确，watch.py将展示json中有bbox属性的图片并标注出bbox，以便可视化检查数据标注质量。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># watch.py</span></span><br><span class="line"><span class="comment"># 查看标注框是否正确</span></span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> cv2</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="comment"># 加载 JSON 文件</span></span><br><span class="line"><span class="comment"># nanodet_train.json</span></span><br><span class="line"><span class="comment"># nanodet_train_zengqian.json</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;nanodet_train_zengqian.json&#x27;</span>, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    data = json.load(f)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取图像目录</span></span><br><span class="line">img_dir = <span class="string">&#x27;./val Enhance/images&#x27;</span></span><br><span class="line"><span class="comment"># img_dir = &#x27;./images&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取屏幕大小</span></span><br><span class="line">screen_width = <span class="number">640</span></span><br><span class="line">screen_height = <span class="number">640</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 遍历图像列表</span></span><br><span class="line"><span class="keyword">for</span> image <span class="keyword">in</span> data[<span class="string">&#x27;images&#x27;</span>]:</span><br><span class="line">    <span class="comment"># 获取图像文件名</span></span><br><span class="line">    img_file_name = image[<span class="string">&#x27;file_name&#x27;</span>]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 打开图像文件</span></span><br><span class="line">    img_path = os.path.join(img_dir, img_file_name)</span><br><span class="line">    img = cv2.imread(img_path)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 缩放图像至屏幕大小</span></span><br><span class="line">    scale = <span class="built_in">min</span>(screen_width / img.shape[<span class="number">1</span>], screen_height / img.shape[<span class="number">0</span>])</span><br><span class="line">    new_size = (<span class="built_in">int</span>(img.shape[<span class="number">1</span>] * scale), <span class="built_in">int</span>(img.shape[<span class="number">0</span>] * scale))</span><br><span class="line">    img = cv2.resize(img, new_size)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 获取 annotations 信息</span></span><br><span class="line">    annotations = [anno <span class="keyword">for</span> anno <span class="keyword">in</span> data[<span class="string">&#x27;annotations&#x27;</span>] <span class="keyword">if</span> anno[<span class="string">&#x27;image_id&#x27;</span>] == image[<span class="string">&#x27;id&#x27;</span>]]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 绘制方框</span></span><br><span class="line">    <span class="keyword">for</span> anno <span class="keyword">in</span> annotations:</span><br><span class="line">        bbox = anno[<span class="string">&#x27;bbox&#x27;</span>]</span><br><span class="line">        x1, y1, w, h = bbox</span><br><span class="line">        cv2.rectangle(img, (x1, y1), (x1 + w, y1 + h), (<span class="number">0</span>, <span class="number">255</span>, <span class="number">0</span>), <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 显示图像</span></span><br><span class="line">    cv2.imshow(img_file_name, img)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 等待按键</span></span><br><span class="line">    cv2.waitKey(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 关闭图像窗口</span></span><br><span class="line">    cv2.destroyAllWindows()</span><br></pre></td></tr></table></figure>
<p>查看数据标注是否正确，以及数据增强后标注是否一同缩放旋转正确对应。</p>
<p><img src="https://cdn.ziyourufeng.eu.org/51hhh/img_bed/main/img/2025/04_27/image_ee377cea19d1127978ade531d9210a6b.png" alt=""></p>
<p><img src="https://cdn.ziyourufeng.eu.org/51hhh/img_bed/main/img/2025/04_27/image_d43e3fcbb6be935819b61df4a51fe077.png" alt=""></p>
<p>分割训练集和测试集，按比例拆分。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># split_coco.py</span></span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">split_coco_data</span>(<span class="params">coco_file, train_ratio=<span class="number">0.8</span>, output_train_file=<span class="string">&quot;train.json&quot;</span>, output_test_file=<span class="string">&quot;test.json&quot;</span></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    将 COCO 标注文件按照指定的比例分割成训练集和测试集。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    参数:</span></span><br><span class="line"><span class="string">        coco_file (str): COCO 标注 JSON 文件的路径。</span></span><br><span class="line"><span class="string">        train_ratio (float): 训练集中图像所占的比例 (默认值: 0.8)。</span></span><br><span class="line"><span class="string">        output_train_file (str): 保存训练集 COCO JSON 文件的路径 (默认值: &quot;train.json&quot;)。</span></span><br><span class="line"><span class="string">        output_test_file (str): 保存测试集 COCO JSON 文件的路径 (默认值: &quot;test.json&quot;)。</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(coco_file, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        coco_data = json.load(f)</span><br><span class="line"></span><br><span class="line">    images = coco_data[<span class="string">&#x27;images&#x27;</span>]  <span class="comment"># 获取所有图像信息</span></span><br><span class="line">    annotations = coco_data[<span class="string">&#x27;annotations&#x27;</span>]  <span class="comment"># 获取所有标注信息</span></span><br><span class="line">    categories = coco_data[<span class="string">&#x27;categories&#x27;</span>] <span class="keyword">if</span> <span class="string">&#x27;categories&#x27;</span> <span class="keyword">in</span> coco_data <span class="keyword">else</span> [] <span class="comment"># 获取类别信息，如果不存在则设为空列表</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 随机打乱图像列表，确保分割的随机性</span></span><br><span class="line">    random.shuffle(images)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 计算训练集的大小</span></span><br><span class="line">    train_size = <span class="built_in">int</span>(<span class="built_in">len</span>(images) * train_ratio)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 分割图像列表为训练集和测试集</span></span><br><span class="line">    train_images = images[:train_size]</span><br><span class="line">    test_images = images[train_size:]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 获取训练集和测试集图像的 ID 列表</span></span><br><span class="line">    train_image_ids = [img[<span class="string">&#x27;id&#x27;</span>] <span class="keyword">for</span> img <span class="keyword">in</span> train_images]</span><br><span class="line">    test_image_ids = [img[<span class="string">&#x27;id&#x27;</span>] <span class="keyword">for</span> img <span class="keyword">in</span> test_images]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 根据图像 ID 过滤标注信息，得到训练集和测试集的标注</span></span><br><span class="line">    train_annotations = [ann <span class="keyword">for</span> ann <span class="keyword">in</span> annotations <span class="keyword">if</span> ann[<span class="string">&#x27;image_id&#x27;</span>] <span class="keyword">in</span> train_image_ids]</span><br><span class="line">    test_annotations = [ann <span class="keyword">for</span> ann <span class="keyword">in</span> annotations <span class="keyword">if</span> ann[<span class="string">&#x27;image_id&#x27;</span>] <span class="keyword">in</span> test_image_ids]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 创建训练集 COCO 数据集</span></span><br><span class="line">    train_coco_data = &#123;</span><br><span class="line">        <span class="string">&#x27;images&#x27;</span>: train_images,</span><br><span class="line">        <span class="string">&#x27;annotations&#x27;</span>: train_annotations,</span><br><span class="line">        <span class="string">&#x27;categories&#x27;</span>: categories  <span class="comment"># 包含类别信息</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 创建测试集 COCO 数据集</span></span><br><span class="line">    test_coco_data = &#123;</span><br><span class="line">        <span class="string">&#x27;images&#x27;</span>: test_images,</span><br><span class="line">        <span class="string">&#x27;annotations&#x27;</span>: test_annotations,</span><br><span class="line">        <span class="string">&#x27;categories&#x27;</span>: categories  <span class="comment"># 包含类别信息</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 将训练集 COCO 数据集保存到 JSON 文件</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(output_train_file, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        json.dump(train_coco_data, f)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 将测试集 COCO 数据集保存到 JSON 文件</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(output_test_file, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        json.dump(test_coco_data, f)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;COCO 数据集分割完成:&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;  - 训练集: <span class="subst">&#123;<span class="built_in">len</span>(train_images)&#125;</span> 张图像, <span class="subst">&#123;<span class="built_in">len</span>(train_annotations)&#125;</span> 个标注 (保存到 <span class="subst">&#123;output_train_file&#125;</span>)&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;  - 测试集: <span class="subst">&#123;<span class="built_in">len</span>(test_images)&#125;</span> 张图像, <span class="subst">&#123;<span class="built_in">len</span>(test_annotations)&#125;</span> 个标注 (保存到 <span class="subst">&#123;output_test_file&#125;</span>)&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="comment"># 将 &#x27;coco_annotations.json&#x27; 替换为你的 COCO 标注文件的实际路径</span></span><br><span class="line">    coco_annotation_file = <span class="string">&quot;nanodet_train.json&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 你可以根据需要调整 train_ratio (例如，0.7 表示 70% 用于训练，30% 用于测试)</span></span><br><span class="line">    split_coco_data(coco_annotation_file, train_ratio=<span class="number">0.8</span>, output_train_file=<span class="string">&quot;train.json&quot;</span>, output_test_file=<span class="string">&quot;test.json&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>得到2：8的测试训练集</p>
<p><img src="https://cdn.ziyourufeng.eu.org/51hhh/img_bed/main/img/2025/04_22/image_3f83fac79fce014064d920e862edef77.png" alt=""></p>
<p>修改配置文件</p>
<p><img src="https://cdn.ziyourufeng.eu.org/51hhh/img_bed/main/img/2025/04_22/image_f31bfc2df8d8a1e1f5010f9ae48904e6.png" alt="原图作者目标检测——使用nanodet训练自己制作的数据集并测试模型，通俗易懂（详细图文教程）nanodet训练自己的模型-CSDN博客"></p>
<p><img src="https://cdn.ziyourufeng.eu.org/51hhh/img_bed/main/img/2025/04_22/image_a0ec75738755bdf3b5686a572738d141.png" alt=""></p>
<p><img src="https://cdn.ziyourufeng.eu.org/51hhh/img_bed/main/img/2025/04_22/image_42341b6952ba0dc378d1537ecce23f9e.png" alt=""></p>
<p><img src="https://cdn.ziyourufeng.eu.org/51hhh/img_bed/main/img/2025/04_22/image_876ac3450d2d1324103d46314c27f217.png" alt=""></p>
<p><img src="https://cdn.ziyourufeng.eu.org/51hhh/img_bed/main/img/2025/04_22/image_e3880b89db68d5e0a4fbd6638e7ab3c1.png" alt=""></p>
<p><img src="https://cdn.ziyourufeng.eu.org/51hhh/img_bed/main/img/2025/04_22/image_96cf0249da0dfe8a0df6eac0a5d150f0.png" alt=""></p>
<h4 id="模型训练">模型训练</h4>
<p>使用配置文件进行训练</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python tools/train.py ./config/legacy_v0.x_configs/nanodet-m.yml</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.ziyourufeng.eu.org/51hhh/img_bed/main/img/2025/04_22/image_fd1fb6d2d41943dd62af1a38d71fac12.png" alt=""></p>
<p>待训练完成后模型保存为pth，默认会按照<code>mAP</code>评分保持最佳模型。</p>
<p><img src="https://cdn.ziyourufeng.eu.org/51hhh/img_bed/main/img/2025/04_22/image_9b5947506fad781acda79faf9c926240.png" alt=""></p>
<p>可以用刚刚训练的模型测试一下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python demo/demo.py video --config ./config/nanodet-m.yml --model ./workspace/nanodet_m/model_best/nanodet_model_best.pth --path ./Video/rc.mp4</span><br></pre></td></tr></table></figure>
<h4 id="恢复中断训练">恢复中断训练</h4>
<p>如果训练意外中断，可以使用PyTorch Lightning 提供的 checkpoint 功能，只需要更改配置文件,将schedule.resume设置为True即可</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">schedule:</span><br><span class="line">  resume: True  # 或者 False，取决于你是否要恢复训练</span><br><span class="line">  # 其他 schedule 配置</span><br></pre></td></tr></table></figure>
<p>重新启动训练<code>python tools/train.py config\nanodet-plus-m-1.5x_416.yml</code></p>
<p>PyTorch Lightning 会自动检测 <code>model_last.ckpt</code> 文件，并从上次保存的 checkpoint 恢复训练。</p>
<p><img src="https://cdn.ziyourufeng.eu.org/51hhh/img_bed/main/img/2025/04_27/image_611d80cbe9d40f3aee9af44120ba8dad.png" alt=""></p>
<h4 id="TensorBoard">TensorBoard</h4>
<p><strong>可视化日志</strong><br>
TensorBoard 日志保存在您在配置文件中设置的位置。<code>save_dir</code><br>
要可视化 tensorboard 日志，请运行：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd &lt;YOUR_SAVE_DIR&gt;</span><br><span class="line">tensorboard --logdir ./</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.ziyourufeng.eu.org/51hhh/img_bed/main/img/2025/04_28/b4b3da70890ef603956e37b84b6f530_b4ee8bf99f4f26281f7daf65224277e2.png" alt=""></p>
<p>观察模型是否收敛：因为仅仅观察损失函数很难判断是否需要停止训练，可观测其性能指标增长趋势逐步调整训练轮次，因为经过数据增强数据集多达5000+，所以此处训练轮次可以适当减少。</p>
<p><img src="https://cdn.ziyourufeng.eu.org/51hhh/img_bed/main/img/2025/05_13/image_fd974217b81aaff2a7233aa8a6f4d92e.png" alt=""></p>
<p>主要观察mAP指标继续训练是否还有增长趋势，若还存在上升趋势可追加训练轮次，直到性能指标趋于平稳，则可认为模型以及拟合。</p>
<p><img src="https://cdn.ziyourufeng.eu.org/51hhh/img_bed/main/img/2025/05_13/image_549d752ebe851cea7cc58dd6b8762c2c.png" alt=""></p>
<p>训练350轮</p>
<p><img src="https://cdn.ziyourufeng.eu.org/51hhh/img_bed/main/img/2025/07_07/image_f392c5d85293f096ae68f117d337acf0.png" alt=""></p>
<h4 id="模型导出">模型导出</h4>
<p>pth转onnx</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python tools/export_onnx.py --cfg_path ./config/nanodet-plus-m-1.5x_416.yml --model_path workspace/nanodet-plus-m-1.5x_416/model_best/nanodet_model_best.pth </span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.ziyourufeng.eu.org/51hhh/img_bed/main/img/2025/07_07/image_33a4f85982336acc62d6bae409081eb8.png" alt=""></p>
<p>onnx转IR</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 示例：将 ONNX 模型转换为 OpenVINO IR</span><br><span class="line">ovc your_model.onnx --output_model openvino_ir</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.ziyourufeng.eu.org/51hhh/img_bed/main/img/2025/05_26/image_a8d620810f85bd2c1b717a70463e804a.png" alt=""></p>
<h4 id="学习率">学习率</h4>
<p>理论：<a href="https://polar-bear.eu.org/2025/04/26/ji-qi-xue-xi-shen-jing-wang-luo/#%E5%AD%A6%E4%B9%A0%E7%8E%87">机器学习——神经网络 | polar-bear～Blog</a></p>
<p>不同学习率：</p>
<ul>
<li><strong>过大的学习率</strong>：可能导致模型在最优解附近震荡，或者在极端情况下导致模型发散。</li>
<li><strong>过小的学习率</strong>：虽然能够保证模型最终收敛，但是会大大降低模型训练的速度。有时，它甚至可能导致模型陷入局部最优解。</li>
</ul>
<p>观察学习率曲线，此处使用<code>学习率预热</code>（warmup）<code>和学习率衰减</code>（Learning Rate Decay）</p>
<p>warm-up 是指在训练的初期，逐渐增加学习率的过程，以帮助模型更好地收敛到最优解，逐渐增加学习率，而不是直接使用高学习率再衰减的原因是防止在模型初始时高学习率快速降低损失函数至局部最优导致模型后期学习率衰减无法跳出局部最优寻找全局最优（长难句，个人理解）</p>
<p><code>ratio: 0.0001  # 预热的起始学习率与 lr 的比率</code>在训练的开始会使用低学习率以实现在训练初期更好地适应数据，提高训练的稳定性和性能。</p>
<p>Learning Rate Decay则使模型在后期<code>精细调节</code>,<code>防止震荡</code>,<code>避免过拟合</code></p>
<p>使用一个简单的线性回归案例，持续高学习率确实可以快速收敛，加快模型收敛速度，突破局部最优寻找全局最优，但是到了模型训练后期，应该缓慢降低学习率，否则高学习率会导致模型陷入局部震荡无法正常收敛，如下图。</p>
<p><img src="https://cdn.ziyourufeng.eu.org/51hhh/img_bed/main/img/2025/05_13/image_997f08afed042fbce1d0371d9e0741b2.png" alt=""></p>
<p><img src="https://cdn.ziyourufeng.eu.org/51hhh/img_bed/main/img/2025/05_13/image_7baf2a48afc3a7df4fee6b8b018e701b.png" alt=""></p>
<p>（在高学习率下线性回归模型损失值会大幅波动。 这表示学习速率过高，模型训练永远不会收敛。）</p>
<p><img src="https://cdn.ziyourufeng.eu.org/51hhh/img_bed/main/img/2025/05_13/image_fc9d8958b385df7f324942831007ad23.png" alt=""></p>
<p>余弦退火衰减 CosineAnnealingLR:</p>
<p>当越来越接近Loss值的全局最小值时，学习率应该变得更小来使得模型尽可能接近这一点，而余弦退火（Cosine annealing）可以通过余弦函数来降低学习率。余弦函数中随着x的增加余弦值首先缓慢下降，然后加速下降，再次缓慢下降。这种下降模式能和学习率配合，以一种十分有效的计算方式来产生很好的效果。</p>
<p>神经网络在刚开始训练时，并非如同理想的情况一样，只需要确定一个方向即可。模型参数在初始化时，是非常不稳定的，因此在刚开始时需要选用小的学习率。</p>
<p><img src="https://cdn.ziyourufeng.eu.org/51hhh/img_bed/main/img/2025/05_13/image_d44662a47557f69a71c9c396b9b9b014.png" alt=""></p>
<p>(图片来自文2)</p>
<p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://blog.csdn.net/weixin_35848967/article/details/108493217">学习率衰减之余弦退火(CosineAnnealing）-CSDN博客</a></p>
<p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://blog.csdn.net/weixin_42392454/article/details/127766771">狗都会用的余弦退火（CosineAnnealingLR）学习率调节算法讲解-CSDN博客</a></p>
<p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://zhuanlan.zhihu.com/p/261134624">pytorch的余弦退火学习率 - 知乎</a></p>
<h3 id="Openvino部署">Openvino部署</h3>
<h4 id="Openvino安装">Openvino安装</h4>
<p>OpenVINOTM安装分为完整版安装与不完整版(Runtime)安装。</p>
<p>完整版安装会安装所有部件，包括模型优化器和推理部署套件运行工具(Runtime)，目前该方式支持PIP安装方式，因此建议采用PIP安装在虚拟环境中，防止安装出错照成电脑环境出现问题。该安装方式至此Python、C++同时使用，由于安装路径较长，对C++使用不太方便，因此该安装方式最好使用Python编程。</p>
<p>非完整版安装主要安装编译环境(Runtime)，安装比较简单，且一般会安装到根目录下，方便使用，因此如果不使用模型优化且情况下，或者使用C++编译环境的话，建议选用此方式。</p>
<p>openvino推荐使用存档直接安装或者conda安装</p>
<p>ubuntu：Ubuntu 24.04.2 LTS</p>
<p>openvino：2025.1</p>
<h4 id="直接安装">直接安装</h4>
<p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://docs.openvino.ai/2025/get-started/install-openvino.html?PACKAGE=OPENVINO_BASE&amp;VERSION=v_2025_1_0&amp;OP_SYSTEM=LINUX&amp;DISTRIBUTION=ARCHIVE">https://docs.openvino.ai/2025/get-started/install-openvino.html?PACKAGE=OPENVINO_BASE&amp;VERSION=v_2025_1_0&amp;OP_SYSTEM=LINUX&amp;DISTRIBUTION=ARCHIVE</a></p>
<p>前往官网下载对应版本</p>
<p><img src="https://cdn.ziyourufeng.eu.org/51hhh/img_bed/main/img/2025/05_26/image_1e104b83793d85d1113fb3c0250d7b87.png" alt=""></p>
<p>在/opt下创建文件夹</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo mkdir /opt/intel</span><br></pre></td></tr></table></figure>
<p>解压后移动到/opt/intel</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tar -xf openvino_2025.0.0.tgz</span><br><span class="line">sudo mv openvino_toolkit_ubuntu22_2025 /opt/intel/openvino_2025.0.0</span><br></pre></td></tr></table></figure>
<p>可以创建软链接，方便路径。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /opt/intel</span><br><span class="line">sudo ln -s openvino_2025.1.0 openvino_2025</span><br></pre></td></tr></table></figure>
<p>安装openvino环境依赖</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /opt/intel/openvino_2025.1.0</span><br><span class="line">sudo -E ./install_dependencies/install_openvino_dependencies.sh</span><br></pre></td></tr></table></figure>
<p>配置环境变量</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim ~/.bashrc</span><br></pre></td></tr></table></figure>
<p>将脚本路径添加进去，这样每次启动终端都会加载openvino</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">source /opt/intel/openvino_2025/setupvars.sh</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.ziyourufeng.eu.org/51hhh/img_bed/main/img/2025/05_26/image_9e114ca70c22f68e1502ba247beddf33.png" alt=""></p>
<h4 id="conda-v2">conda</h4>
<p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://www.anaconda.com/download/success">https://www.anaconda.com/download/success</a></p>
<p>下载conda安装脚本</p>
<p><img src="https://cdn.ziyourufeng.eu.org/51hhh/img_bed/main/img/2025/05_26/image_0a5757c253e705ba3443eeea942110f9.png" alt=""></p>
<p><img src="https://cdn.ziyourufeng.eu.org/51hhh/img_bed/main/img/2025/05_26/image_eabff0f73ea17fa23bb257ed5c2e78c4.png" alt=""></p>
<p>一路yes即可</p>
<p><img src="https://cdn.ziyourufeng.eu.org/51hhh/img_bed/main/img/2025/05_26/image_a90713cbd3cd574ccc99d77e14ab7909.png" alt=""></p>
<p><img src="https://cdn.ziyourufeng.eu.org/51hhh/img_bed/main/img/2025/05_26/image_8eee5eacc8186c972619bb8f53ee1772.png" alt=""></p>
<p><img src="https://cdn.ziyourufeng.eu.org/51hhh/img_bed/main/img/2025/05_26/image_12374777e2ddd287953263653fd3fecd.png" alt=""></p>
<p>完成安装，刷新一下终端</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source ~/.bashrc</span><br></pre></td></tr></table></figure>
<p>输入</p>
<p>conda</p>
<p><img src="https://cdn.ziyourufeng.eu.org/51hhh/img_bed/main/img/2025/05_26/image_d52e8f059ef1e60ce28099f5a95eda20.png" alt=""></p>
<p>安装完成后最好升级一下conda</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">conda update -n base -c defaults conda</span><br></pre></td></tr></table></figure>
<p>创建虚拟环境</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">conda create --name py310 python=3.10</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.ziyourufeng.eu.org/51hhh/img_bed/main/img/2025/05_26/image_99a32e7b486a6ea81785320fd1d041b8.png" alt=""></p>
<p>进入虚拟环境</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">conda activate py310</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.ziyourufeng.eu.org/51hhh/img_bed/main/img/2025/05_26/image_604db87a2add371ceea9c0c6fb7e3ee5.png" alt=""></p>
<p>将以下命令行添加到 ~/.bashrc ，只需要在终端输入 py310 就直接进入了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alias py310=&#x27;source activate py310&#x27;</span><br></pre></td></tr></table></figure>
<p>使用conda安装openvino</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">conda update --all</span><br><span class="line">conda install -c conda-forge openvino=2025.1.0</span><br></pre></td></tr></table></figure>
<p>openvino安装位置位于</p>
<p>/home/rick/anaconda3/envs/py310/include</p>
<p>/home/rick/anaconda3/envs/py310/lib</p>
<h4 id="测试openvino安装状态">测试openvino安装状态</h4>
<p>新建main.cpp</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;openvino/openvino.hpp&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// 初始化OpenVINO核心</span></span><br><span class="line">        ov::Core core;</span><br><span class="line">  </span><br><span class="line">        <span class="comment">// 打印OpenVINO版本信息</span></span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;OpenVINO version: &quot;</span> &lt;&lt; ov::<span class="built_in">get_openvino_version</span>() &lt;&lt; std::endl;</span><br><span class="line">  </span><br><span class="line">        <span class="comment">// 获取可用设备列表</span></span><br><span class="line">        std::vector&lt;std::string&gt; available_devices = core.<span class="built_in">get_available_devices</span>();</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Available devices: &quot;</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">const</span> <span class="keyword">auto</span>&amp; device : available_devices) &#123;</span><br><span class="line">            std::cout &lt;&lt; device &lt;&lt; <span class="string">&quot; &quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        std::cout &lt;&lt; std::endl;</span><br><span class="line">  </span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125; <span class="built_in">catch</span> (<span class="type">const</span> std::exception&amp; ex) &#123;</span><br><span class="line">        std::cerr &lt;&lt; <span class="string">&quot;Exception: &quot;</span> &lt;&lt; ex.<span class="built_in">what</span>() &lt;&lt; std::endl;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>新建CMakeLists.txt</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">cmake_minimum_required(VERSION 3.5)</span><br><span class="line">project(openvino_test)</span><br><span class="line"></span><br><span class="line">set(CMAKE_CXX_STANDARD 17)</span><br><span class="line">set(CMAKE_CXX_STANDARD_REQUIRED ON)</span><br><span class="line"></span><br><span class="line"># 设置OpenVINO路径</span><br><span class="line">set(OpenVINO_DIR &quot;/opt/intel/openvino_2025/runtime/include&quot;)</span><br><span class="line"></span><br><span class="line"># 查找OpenVINO包</span><br><span class="line">find_package(OpenVINO REQUIRED)</span><br><span class="line"></span><br><span class="line"># 添加可执行文件</span><br><span class="line">add_executable(openvino_test main.cpp)</span><br><span class="line"></span><br><span class="line"># 链接OpenVINO库</span><br><span class="line">target_link_libraries(openvino_test PRIVATE openvino::runtime)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>执行：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p build &amp;&amp; cd build &amp;&amp; cmake .. &amp;&amp; make</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.ziyourufeng.eu.org/51hhh/img_bed/main/img/2025/05_26/image_68470ac041338aaf80bb0aeac2f40aac.png" alt=""></p>
<p><code>ctrl</code>+<code>shift</code>+<code>p</code>或<code>F1</code>打开快捷指令输入</p>
<blockquote>
<p>edit configurations (UI)</p>
</blockquote>
<p>找到include路径，将openvino路径填入，防止code找不到库，导致include报红。</p>
<p><img src="https://cdn.ziyourufeng.eu.org/51hhh/img_bed/main/img/2025/05_26/image_7eef4f4ebda58de14b358f0fdc109c64.png" alt=""></p>
<p>选择调试配置，使用Cmake</p>
<p><img src="https://cdn.ziyourufeng.eu.org/51hhh/img_bed/main/img/2025/05_26/image_d6874c9fefd085d1c9c3b1eefb52bd90.png" alt=""></p>
<p>点击cmake插件底部的运行即可使用cmakelist完成编译运行。</p>
<h4 id="安装opencv">安装opencv</h4>
<p>直接安装在系统目录</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install libopencv-dev</span><br></pre></td></tr></table></figure>
<p>在cmakelist.txt可以使用</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 查找依赖包</span><br><span class="line">find_package(OpenCV REQUIRED)</span><br></pre></td></tr></table></figure>
<p>自动搜索到。</p>
<h4 id="安装海康MVS">安装海康MVS</h4>
<p>到下载页面下载：<a target="_blank" rel="noopener external nofollow noreferrer" href="https://www.hikrobotics.com/cn/machinevision/service/download/?module=0">https://www.hikrobotics.com/cn/machinevision/service/download/?module=0</a></p>
<p>下载 机器视觉工业相机客户端MVS V3.0.1 (Linux)</p>
<p><img src="https://cdn.ziyourufeng.eu.org/51hhh/img_bed/main/img/2025/06_04/image_2ee0aabe66d16ff2545dd79368114319.png" alt=""></p>
<p>下载的压缩包中含有不同架构的安装包</p>
<p>安装</p>
<p>sudo dpkg -i MVS-3.0.1_x86_64_20241128.deb</p>
<p><img src="https://cdn.ziyourufeng.eu.org/51hhh/img_bed/main/img/2025/06_04/image_a2776772ed79e258e2338981e1ff8714.png" alt=""></p>
<p>安装在/opt/MVS 目录下</p>
<p><img src="https://cdn.ziyourufeng.eu.org/51hhh/img_bed/main/img/2025/06_07/image_d744d43f7cbc8acc94e7e0ea62ea2600.png" alt=""></p>
<p>运行<code>/opt/MVS/bin/MVS.sh</code>测试是否安装成功。</p>
<h4 id="摄像头频闪">摄像头频闪</h4>
<p>若遇到频闪，则调整曝光时间避开场地光源频率</p>
<p><img src="https://cdn.ziyourufeng.eu.org/51hhh/img_bed/main/img/2025/06_19/image_39014a085edb85a765b1a4e36ef81d4f.png" alt=""></p>
<h4 id="boost安装">boost安装</h4>
<p>前往官网下载：<a target="_blank" rel="noopener external nofollow noreferrer" href="https://www.boost.org/releases/1.74.0/">https://www.boost.org/releases/1.74.0/</a></p>
<p><img src="https://cdn.ziyourufeng.eu.org/51hhh/img_bed/main/img/2025/06_30/image_542305a436d558842c0bfed15dd386c1.png" alt=""></p>
<p>下载后解压到任意路径</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">mv</span> ./boost_1_74_0 /opt/boost_1_74_0</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.ziyourufeng.eu.org/51hhh/img_bed/main/img/2025/06_30/image_7bfc3f7e9023c22ad7e9f6da640bce12.png" alt=""></p>
<p>执行安装脚本</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./bootstrap.sh </span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.ziyourufeng.eu.org/51hhh/img_bed/main/img/2025/06_30/image_23200a47690e11c0ef82e91a32e90fa1.png" alt=""></p>
<p>运行构建命令：./b2</p>
<p><img src="https://cdn.ziyourufeng.eu.org/51hhh/img_bed/main/img/2025/06_30/image_ef25561c023294ef0e45f6dc7c4654f1.png" alt=""></p>
<p>安装库文件：sudo ./b2 install</p>
<p><img src="https://cdn.ziyourufeng.eu.org/51hhh/img_bed/main/img/2025/06_30/image_62ea0df3154cdfc0cd3549eea59bb06d.png" alt=""></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://polar-bear.eu.org">Ziyourufeng</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://polar-bear.eu.org/2025/04/21/nanodet-xun-lian-ce-shi/">https://polar-bear.eu.org/2025/04/21/nanodet-xun-lian-ce-shi/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="null" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://polar-bear.eu.org" target="_blank">polar-bear～Blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="/img/test/30.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.polar-bear.eu.org/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.polar-bear.eu.org/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="https://polar-bear.eu.org/" target="_blank"><img class="post-qr-code-img" src="/img/zanzhuwechat.png" alt="wechat"/></a><div class="post-qr-code-desc">wechat</div></li><li class="reward-item"><a href="https://polar-bear.eu.org/" target="_blank"><img class="post-qr-code-img" src="/img/zanzhualipay.jpg" alt="Alipay"/></a><div class="post-qr-code-desc">Alipay</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2025/04/26/ji-qi-xue-xi-shen-jing-wang-luo/" title="机器学习——神经网络"><img class="cover" src="/img/test/17.png" onerror="onerror=null;src='/img/404.png'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">机器学习——神经网络</div></div></a></div><div class="next-post pull-right"><a href="/2025/04/10/zai-docker-zhong-an-zhuang-postgresql/" title="在Docker中安装Postgresql"><img class="cover" src="/img/test/37.png" onerror="onerror=null;src='/img/404.png'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">在Docker中安装Postgresql</div></div></a></div></nav><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/hand.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Ziyourufeng</div><div class="author-info__description">技术宅拯救世界~~!</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">86</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">19</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">10</div></a></div><a id="card-info-btn" target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/51hhh"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/51hhh" rel="external nofollow noreferrer" target="_blank" title="Github"><i class="fab fa-github" style="color: 51hhh;"></i></a><a class="social-icon" href="mailto:ziyourufeng@duck.com" rel="external nofollow noreferrer" target="_blank" title="Email"><i class="fas fa-envelope" style="color: ziyourufeng;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">已更换Twikoo评论，现在可在文末留言啦，可在左下角聊天，邮箱，telegram，QQ群等方式与我取得联系</div></div><div class="card-widget"><div class="item-headline"><i class="fas fa-desktop"></i><span></span></div><div class="item-content"><div>
<span id="timeDate">载入天数...</span><span id="times">载入时分秒...</span>
<script>
    var now = new Date();
    function createtime() {
        var grt= new Date("12/1/2021 00:00:00");
        now.setTime(now.getTime()+250);
        days = (now - grt ) / 1000 / 60 / 60 / 24; dnum = Math.floor(days);
        hours = (now - grt ) / 1000 / 60 / 60 - (24 * dnum); hnum = Math.floor(hours);
        if(String(hnum).length ==1 ){hnum = "0" + hnum;} minutes = (now - grt ) / 1000 /60 - (24 * 60 * dnum) - (60 * hnum);
        mnum = Math.floor(minutes); if(String(mnum).length ==1 ){mnum = "0" + mnum;}
        seconds = (now - grt ) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum);
        snum = Math.round(seconds); if(String(snum).length ==1 ){snum = "0" + snum;}
        document.getElementById("timeDate").innerHTML = "本站已安全运行 "+dnum+" 天 ";
        document.getElementById("times").innerHTML = hnum + " 小时 " + mnum + " 分 " + snum + " 秒";
    }
    setInterval(createtime, 250);
</script>
</div>
</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#NanoDet%E8%AE%AD%E7%BB%83"><span class="toc-number">1.</span> <span class="toc-text">NanoDet训练</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#conda"><span class="toc-number">1.1.</span> <span class="toc-text">conda</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#pytorch"><span class="toc-number">1.2.</span> <span class="toc-text">pytorch</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#NanoDet"><span class="toc-number">1.3.</span> <span class="toc-text">NanoDet</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E8%AE%AD%E7%BB%83%E6%A8%A1%E5%9E%8B"><span class="toc-number">1.4.</span> <span class="toc-text">自训练模型</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E9%9B%86%E5%87%86%E5%A4%87"><span class="toc-number">1.4.1.</span> <span class="toc-text">数据集准备</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A8%A1%E5%9E%8B%E8%AE%AD%E7%BB%83"><span class="toc-number">1.4.2.</span> <span class="toc-text">模型训练</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%81%A2%E5%A4%8D%E4%B8%AD%E6%96%AD%E8%AE%AD%E7%BB%83"><span class="toc-number">1.4.3.</span> <span class="toc-text">恢复中断训练</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#TensorBoard"><span class="toc-number">1.4.4.</span> <span class="toc-text">TensorBoard</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A8%A1%E5%9E%8B%E5%AF%BC%E5%87%BA"><span class="toc-number">1.4.5.</span> <span class="toc-text">模型导出</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AD%A6%E4%B9%A0%E7%8E%87"><span class="toc-number">1.4.6.</span> <span class="toc-text">学习率</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Openvino%E9%83%A8%E7%BD%B2"><span class="toc-number">1.5.</span> <span class="toc-text">Openvino部署</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Openvino%E5%AE%89%E8%A3%85"><span class="toc-number">1.5.1.</span> <span class="toc-text">Openvino安装</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%9B%B4%E6%8E%A5%E5%AE%89%E8%A3%85"><span class="toc-number">1.5.2.</span> <span class="toc-text">直接安装</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#conda-v2"><span class="toc-number">1.5.3.</span> <span class="toc-text">conda</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95openvino%E5%AE%89%E8%A3%85%E7%8A%B6%E6%80%81"><span class="toc-number">1.5.4.</span> <span class="toc-text">测试openvino安装状态</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%89%E8%A3%85opencv"><span class="toc-number">1.5.5.</span> <span class="toc-text">安装opencv</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E6%B5%B7%E5%BA%B7MVS"><span class="toc-number">1.5.6.</span> <span class="toc-text">安装海康MVS</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%91%84%E5%83%8F%E5%A4%B4%E9%A2%91%E9%97%AA"><span class="toc-number">1.5.7.</span> <span class="toc-text">摄像头频闪</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#boost%E5%AE%89%E8%A3%85"><span class="toc-number">1.5.8.</span> <span class="toc-text">boost安装</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/08/26/exo/" title="exo"><img src="/img/test/27.png" onerror="this.onerror=null;this.src='/img/404.png'" alt="exo"/></a><div class="content"><a class="title" href="/2025/08/26/exo/" title="exo">exo</a><time datetime="2025-08-26T23:08:40.988Z" title="发表于 2025-08-27 07:08:40">2025-08-27</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/08/17/qwen-image/" title="Qwen-image"><img src="/img/test/23.png" onerror="this.onerror=null;this.src='/img/404.png'" alt="Qwen-image"/></a><div class="content"><a class="title" href="/2025/08/17/qwen-image/" title="Qwen-image">Qwen-image</a><time datetime="2025-08-17T18:42:39.301Z" title="发表于 2025-08-18 02:42:39">2025-08-18</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/08/14/esp-csi-dong-zuo-fen-lei/" title="ESP CSI 动作分类"><img src="/img/test/5.png" onerror="this.onerror=null;this.src='/img/404.png'" alt="ESP CSI 动作分类"/></a><div class="content"><a class="title" href="/2025/08/14/esp-csi-dong-zuo-fen-lei/" title="ESP CSI 动作分类">ESP CSI 动作分类</a><time datetime="2025-08-14T00:50:57.461Z" title="发表于 2025-08-14 08:50:57">2025-08-14</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/07/03/ji-qi-xue-xi-shen-du-xue-xi/" title="机器学习——深度学习"><img src="/img/test/20.png" onerror="this.onerror=null;this.src='/img/404.png'" alt="机器学习——深度学习"/></a><div class="content"><a class="title" href="/2025/07/03/ji-qi-xue-xi-shen-du-xue-xi/" title="机器学习——深度学习">机器学习——深度学习</a><time datetime="2025-07-03T05:51:52.154Z" title="发表于 2025-07-03 13:51:52">2025-07-03</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/04/26/ji-qi-xue-xi-shen-jing-wang-luo/" title="机器学习——神经网络"><img src="/img/test/17.png" onerror="this.onerror=null;this.src='/img/404.png'" alt="机器学习——神经网络"/></a><div class="content"><a class="title" href="/2025/04/26/ji-qi-xue-xi-shen-jing-wang-luo/" title="机器学习——神经网络">机器学习——神经网络</a><time datetime="2025-04-26T18:35:00.559Z" title="发表于 2025-04-27 02:35:00">2025-04-27</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2022 - 2025 By Ziyourufeng</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener external nofollow noreferrer" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="chat-btn" type="button" title="聊天"><i class="fas fa-sms"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.polar-bear.eu.org/fancybox.umd.min.js"></script><div class="js-pjax"><script>if (!window.MathJax) {
  window.MathJax = {
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']],
      tags: 'ams'
    },
    chtml: {
      scale: 1.1
    },
    options: {
      renderActions: {
        findScript: [10, doc => {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/)
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
            const text = document.createTextNode('')
            node.parentNode.replaceChild(text, node)
            math.start = {node: text, delim: '', n: 0}
            math.end = {node: text, delim: '', n: 0}
            doc.math.push(math)
          }
        }, '']
      }
    }
  }
  
  const script = document.createElement('script')
  script.src = 'https://cdn.jsdelivr.net/npm/mathjax/es5/tex-mml-chtml.min.js'
  script.id = 'MathJax-script'
  script.async = true
  document.head.appendChild(script)
} else {
  MathJax.startup.document.state(0)
  MathJax.texReset()
  MathJax.typesetPromise()
}</script><script>(()=>{
  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: 'https://twikoo.polar-bear.eu.org/',
      region: '',
      onCommentLoaded: function () {
        btf.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      }
    }, null))
  }

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: 'https://twikoo.polar-bear.eu.org/',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(function (res) {
      countELement.textContent = res[0].count
    }).catch(function (err) {
      console.error(err);
    });
  }

  const runFn = () => {
    init()
    
  }

  const loadTwikoo = () => {
    if (typeof twikoo === 'object') {
      setTimeout(runFn,0)
      return
    } 
    getScript('https://cdn.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js').then(runFn)
  }

  if ('Twikoo' === 'Twikoo' || !true) {
    if (true) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo()
  } else {
    window.loadOtherComment = () => {
      loadTwikoo()
    }
  }
})()</script></div><meting-js id="8492133976" server="netease" type="playlist" fixed="true" mutex="true" preload="auto" theme="var(--anzhiyu-main)" order="list"></meting-js><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="/js/canvas-nest.min.js"></script><script id="click-show-text" src="/js/click-show-text.min.js" data-mobile="false" data-text="富强,民主,文明,和谐,自由,平等,公正,法制,爱国,敬业,诚信,友善" data-fontsize="15px" data-random="false" async="async"></script><link rel="stylesheet" href="/css/APlayer.min.css" media="print" onload="this.media='all'"><script src="/js/APlayer.min.js"></script><script src="/js/Meting2.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div class="no-result" id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div><!-- hexo injector body_end start --><script>
    // 全局变量声明区域
    var fdata = {
      apiurl: 'https://friends.polar-bear.eu.org/',
      initnumber: 30, //【可选】页面初始化展示文章数量
      stepnumber: 30, //【可选】每次加载增加的篇数
      error_img: 'https://npm.elemecdn.com/akilar-candyassets/image/404.gif' //【可选，头像图片加载失败时的默认头像】
    }
    //存入本地存储
    localStorage.setItem("fdatalist",JSON.stringify(fdata))
    </script>
    <script data-pjax src="/js/fetch.js"></script><script data-pjax src="https://polar-bear.eu.org/js/random-friends-post.js"></script><script async src="/js/ali_font.js"></script><div class="js-pjax"><script async="async">var arr = document.getElementsByClassName('recent-post-item');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__zoomIn');
    arr[i].setAttribute('data-wow-duration', '1.5s');
    arr[i].setAttribute('data-wow-delay', '200ms');
    arr[i].setAttribute('data-wow-offset', '30');
    arr[i].setAttribute('data-wow-iteration', '1');
  }</script><script async="async">var arr = document.getElementsByClassName('card-widget');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__zoomIn');
    arr[i].setAttribute('data-wow-duration', '');
    arr[i].setAttribute('data-wow-delay', '200ms');
    arr[i].setAttribute('data-wow-offset', '');
    arr[i].setAttribute('data-wow-iteration', '');
  }</script><script async="async">var arr = document.getElementsByClassName('flink-list-card');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__flipInY');
    arr[i].setAttribute('data-wow-duration', '3s');
    arr[i].setAttribute('data-wow-delay', '');
    arr[i].setAttribute('data-wow-offset', '');
    arr[i].setAttribute('data-wow-iteration', '');
  }</script><script async="async">var arr = document.getElementsByClassName('flink-list-card');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__animated');
    arr[i].setAttribute('data-wow-duration', '3s');
    arr[i].setAttribute('data-wow-delay', '');
    arr[i].setAttribute('data-wow-offset', '');
    arr[i].setAttribute('data-wow-iteration', '');
  }</script><script async="async">var arr = document.getElementsByClassName('article-sort-item');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__slideInRight');
    arr[i].setAttribute('data-wow-duration', '1.5s');
    arr[i].setAttribute('data-wow-delay', '');
    arr[i].setAttribute('data-wow-offset', '');
    arr[i].setAttribute('data-wow-iteration', '');
  }</script><script async="async">var arr = document.getElementsByClassName('site-card');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__flipInY');
    arr[i].setAttribute('data-wow-duration', '3s');
    arr[i].setAttribute('data-wow-delay', '');
    arr[i].setAttribute('data-wow-offset', '');
    arr[i].setAttribute('data-wow-iteration', '');
  }</script><script async="async">var arr = document.getElementsByClassName('site-card');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__animated');
    arr[i].setAttribute('data-wow-duration', '3s');
    arr[i].setAttribute('data-wow-delay', '');
    arr[i].setAttribute('data-wow-offset', '');
    arr[i].setAttribute('data-wow-iteration', '');
  }</script></div><script defer src="https://cdn.cbd.int/hexo-butterfly-wowjs/lib/wow.min.js"></script><script defer src="https://cdn.cbd.int/hexo-butterfly-wowjs/lib/wow_init.js"></script><script data-pjax src="/js/hexo-filter-gitcalendar.js"></script><script data-pjax>
  function gitcalendar_injector_config(){
      var parent_div_git = document.getElementById('recent-posts');
      var item_html = '<div class="recent-post-item" id="gitcalendarBar" style="width:100%;height:auto;padding:10px;"><style>#git_container{min-height: 280px}@media screen and (max-width:650px) {#git_container{min-height: 0px}}</style><div id="git_loading" style="width:10%;height:100%;margin:0 auto;display: block;"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 50 50" style="enable-background:new 0 0 50 50" xml:space="preserve"><path fill="#d0d0d0" d="M25.251,6.461c-10.318,0-18.683,8.365-18.683,18.683h4.068c0-8.071,6.543-14.615,14.615-14.615V6.461z" transform="rotate(275.098 25 25)"><animatetransform attributeType="xml" attributeName="transform" type="rotate" from="0 25 25" to="360 25 25" dur="0.6s" repeatCount="indefinite"></animatetransform></path></svg><style>#git_container{display: none;}</style></div><div id="git_container"></div></div>';
      parent_div_git.insertAdjacentHTML("afterbegin",item_html)
      console.log('已挂载gitcalendar')
      }

    if( document.getElementById('recent-posts') && (location.pathname ==='all'|| 'all' ==='all')){
        gitcalendar_injector_config()
        GitCalendarInit("https://gitapi.polar-bear.eu.org/api?51hhh",['#e4dfd7', '#f9f4dc', '#f7e8aa', '#f7e8ba', '#f8df72', '#fcd217', '#fcc515', '#f28e16', '#fb8b05', '#d85916', '#f43e06'],'51hhh')
    }
  </script><script data-pjax src="https://npm.elemecdn.com/oh-my-live2d@0.3.0/dist/index.min.js"></script><script>
OML2D.loadOhMyLive2D({
  source:"",
  mobileShow:true,
  sayHello:false,
  transitionTime:1000,
  models:[{"scale":1.2,"path":"/live2d-model-xiaohei/黑崽生日快乐2023.model3.json","x":0,"y":0,"stageStyle":{"backgroundColor":"rgba(0, 0, 0, 0)","width":"auto","height":"auto"}}],
  tips:{
    style:{"width":230,"height":120,"offsetX":0,"offsetY":90},
    
    
    idleTips:{
      
      
      interval:15000,
      
      remote:function() {
  return new Promise((resolve, reject) => {
    $.ajax({
      type: 'get',
      url: 'https://v1.hitokoto.cn?c=i',
      dataType: 'json',
      success: res => {
       // console.log(res);
        resolve({text: res.hitokoto});
      }
    });
  });
}
,
    }
  }
  });
  </script><!-- hexo injector body_end end --><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/tororo.model.json"},"display":{"position":"right","width":180,"height":300},"mobile":{"show":true},"react":{"opacity":0.7},"log":false});</script></body></html>